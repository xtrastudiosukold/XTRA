import{r as a,a as h,j as o}from"./jsx-runtime-f40812bf.js";import{M as _,a2 as y,b,f as A,L as n,bu as Y,bv as U,x as w,bw as x,bx as I,C as g,h as B,c as k}from"./Phone-eb89da6c.js";import{f as L,r as S}from"./number-28525126.js";function $({children:e,text:t}){const[d,C]=a.useState(!1);return h("div",{className:"tooltip-wrapper",onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:[e,o(_,{children:d&&o(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"tooltip top",children:o("div",{dangerouslySetInnerHTML:{__html:t}})})})]})}const N=a.createContext(null);function G(){var m;const e=b(B),t=b(k.Settings),[d,C]=a.useState(0),[p,T]=a.useState([]),[v,i]=a.useState(""),[c,P]=a.useState("0"),[s,l]=a.useState(t==null?void 0:t.streamerMode);a.useEffect(()=>{A("Crypto",{action:"get"}).then(r=>{r&&T(r)})},[]),a.useEffect(()=>C(p.reduce((r,O)=>r+(O.owned??0)*O.current_price,0)),[p]),a.useEffect(()=>{P(s?L("âˆ—".repeat(S(d,2).toString().length)):L(S(d,2)))},[d,s]);const u=r=>{let O={0:50,10:45,12:40,14:35},E=0;for(let f=0;f<Object.keys(O).length;f++)r.length>=parseInt(Object.keys(O)[f])&&(E=O[Object.keys(O)[f]]);return E};return h("div",{className:"crypto-container",children:[h("div",{className:"crypto-header",children:[o("img",{src:"./assets/img/icons/apps/Cryptopng.png",alt:"btc"}),n("APPS.CRYPTO.TITLE")]}),o(N.Provider,{value:{Coins:[p,T]},children:h("div",{className:"crypto-wrapper",children:[h("div",{className:"balance",children:[h("div",{className:"title",children:[n("APPS.CRYPTO.BALANCE"),o("div",{className:"icon",onClick:()=>l(!s),children:s?o(Y,{}):o(U,{})})]}),o("div",{className:"amount",style:{fontSize:u(c.toString())},onClick:()=>l(!s),children:(m=e==null?void 0:e.CurrencyFormat)==null?void 0:m.replace("%s",c.toString())})]}),o("div",{className:"search",children:o(w,{placeholder:"Search Cryptocurrency",onChange:r=>i(r.target.value)})}),o(D,{search:v}),o("div",{className:"credits",children:"Powered by CoinGecko"})]})})]})}const D=({search:e})=>{const[t,d]=a.useState("balance"),[C,p]=a.useState(!0),T=["Name","Graph","Balance"],[v]=a.useContext(N).Coins;return o("div",{className:"holdings",children:h("div",{className:"items",children:[o("div",{className:"item filters",children:T.map((i,c)=>h("div",{className:"filter",onClick:()=>{if(d(i.toLowerCase()),t===i.toLowerCase())return p(!C);p(!0)},children:[i,i.toLowerCase()===t&&C?o(x,{}):o(I,{})]},c))}),v.sort((i,c)=>t==="name"?C?i.name.localeCompare(c.name):c.name.localeCompare(i.name):t==="graph"?C?i.change_24h-c.change_24h:c.change_24h-i.change_24h:t==="balance"?C?(c.owned??0)*c.current_price-(i.owned??0)*i.current_price:(i.owned??0)*i.current_price-(c.owned??0)*c.current_price:0).filter(i=>i.name.toLowerCase().includes(e.toLowerCase())||i.symbol.toLowerCase().includes(e.toLowerCase())).map((i,c)=>o(M,{data:i},c))]})})},M=({data:e})=>{const[t,d]=a.useState(!1),[C,p]=a.useState(""),[T,v]=a.useContext(N).Coins,i=(P,s)=>{s>1?A("Crypto",{action:"buy",coin:P,amount:s}).then(l=>{if(l!=null&&l.success)return v(u=>u.map(m=>m.id===P?{...m,owned:(m.owned??0)+s/m.current_price,value:(m.value??0)+s,invested:(m.invested??0)+s}:m));l!=null&&l.msg&&setTimeout(()=>{g.PopUp.set({title:n("APPS.CRYPTO.ERROR"),description:n(`APPS.CRYPTO.${l.msg}`),buttons:[{title:n("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{g.PopUp.set({title:n("APPS.CRYPTO.ERROR"),description:n("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:"buy"}),buttons:[{title:n("APPS.CRYPTO.CLOSE")}]})},250)},c=(P,s,l)=>{l>0?A("Crypto",{action:"sell",coin:P,amount:l}).then(u=>{if(u!=null&&u.success)return v(m=>m.map(r=>r.id===P?{...r,owned:(r.owned??0)-s/r.current_price,value:(r.value??0)+s,invested:(r.invested??0)-s}:r));u!=null&&u.msg&&setTimeout(()=>{g.PopUp.set({title:n("APPS.CRYPTO.ERROR"),description:n(`APPS.CRYPTO.${u.msg}`),buttons:[{title:n("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{g.PopUp.set({title:n("APPS.CRYPTO.ERROR"),description:n("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:"sell"}),buttons:[{title:n("APPS.CRYPTO.CLOSE")}]})},250)};return e.symbol=e.symbol.toUpperCase(),e.owned=e.owned??0,e.value=e.current_price*(e.owned??0),h("div",{className:"item",onClick:()=>d(!t),children:[h("div",{className:"top",children:[h("div",{className:"info",children:[o("img",{src:e.image,className:"icon",alt:"Icon"}),h("div",{className:"coin",children:[o("div",{className:"name",children:e.symbol}),o("div",{className:"symbol",children:e.name})]})]}),o(j,{data:e}),h("div",{className:"amount",children:[o("div",{className:"value",children:L(S(e.owned,4))}),h("div",{className:"asset",children:["$",L(S(e.value,2))]})]})]}),o(_,{children:t&&h(y.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"bottom",children:[o(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button fill",onClick:P=>{P.stopPropagation(),g.PopUp.set({title:n("APPS.CRYPTO.BUY_POPUP.TITLE").format({coin:e.symbol}),description:n("APPS.CRYPTO.BUY_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:n("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:0,onChange:s=>p(s)},buttons:[{title:n("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:n("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{p(s=>(i(e.id,parseFloat(s)),s))}}]})},children:n("APPS.CRYPTO.BUY")}),o(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button",onClick:P=>{P.stopPropagation(),g.PopUp.set({title:n("APPS.CRYPTO.SELL_POPUP.TITLE").format({coin:e.symbol}),description:n("APPS.CRYPTO.SELL_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:n("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:0,onChange:s=>p(s)},buttons:[{title:n("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:n("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{p(s=>{let l=parseFloat(s),u=l/e.current_price;return c(e.id,l,u),s})}}]})},children:n("APPS.CRYPTO.SELL")}),o(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button red",onClick:P=>{P.stopPropagation(),g.PopUp.set({title:n("APPS.CRYPTO.SELL_ALL_POPUP.TITLE").format({coin:e.symbol}),description:n("APPS.CRYPTO.SELL_ALL_POPUP.DESCRIPTION").format({coin:e.symbol,amount:e.owned*e.current_price}),buttons:[{title:n("APPS.CRYPTO.SELL_ALL_POPUP.CANCEL")},{title:n("APPS.CRYPTO.SELL_ALL_POPUP.PROCEED"),color:"red",cb:()=>{let s=e.owned*e.current_price;c(e.id,s,e.owned)}}]})},children:n("APPS.CRYPTO.SELL_ALL")})]})})]})},j=e=>{if(!(e!=null&&e.data.prices))return null;let t=e.data.prices;const d=a.useRef(null),[C,p]=a.useState(null),[T,v]=a.useState(null);return t=t.slice(0,24),a.useEffect(()=>{if(!(d!=null&&d.current))return;const i=d.current;i.width=150,i.height=100;const c=i.getContext("2d");c.lineWidth=3;const P=Math.min(...t),l=Math.max(...t)-P,u=i.height-10;let m=0,r=i.height-5-(t[0]-P)/l*u;c.beginPath(),c.moveTo(m,r);const O=t[t.length-1]-t[0]>0?"green":"red";c.strokeStyle=O;for(let R=1;R<t.length;R++)m+=i.width/(t.length-1),r=i.height-5-(t[R]-P)/l*u,c.lineTo(m,r);c.stroke();const E=(t[t.length-1]-t[0])/t[0]*100;E>0?p(`<div style="color: var(--phone-color-green)">+${S(E,2)}%</div>`):E<0?p(`<div style="color: var(--phone-color-red)">${S(E,2)}%</div>`):p(`<div>${S(E,2)}%</div>`);let f=(e.data.value-e.data.invested)/e.data.invested*100;f>0?v(`<div style="color: var(--phone-color-green)">+${S(f,2)}%</div>`):f<0&&v(`<div style="color: var(--phone-color-red)">${S(f,2)}%</div>`)},[d,t]),o($,{text:`$${S(e.data.current_price,2)} ${C??""} ${T??""}`,children:o("canvas",{ref:d})})};export{G as default};
