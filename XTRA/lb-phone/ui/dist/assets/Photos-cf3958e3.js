import{r,j as s,a as v,F as H}from"./jsx-runtime-f40812bf.js";import{f as C,L as m,ax as b,C as N,W as B,b as k,M as D,a2 as V,I as U,Z as X,ay as x,h as F,c as z,az as A}from"./Phone-eb89da6c.js";import{r as G}from"./number-28525126.js";import{C as _}from"./Check-b689eec4.js";function J(){const f=r.useRef(null),[E,S]=r.useState(!1),[a,P]=r.useState([]),[d,T]=r.useState(null),[u,p]=r.useState([]),[g,y]=r.useState(0),[i,O]=r.useState(!1),[M,L]=r.useState(!1);r.useEffect(()=>{C("Camera",{action:"getImages",page:0,filter:{showVideos:!0,showPhotos:!0}}).then(c=>{c&&p(c.reverse())})},[]);const n=c=>{if(M||i)return;let l=document.querySelector("#last");if(!l)return;!B(l)&&(O(!0),C("Camera",{action:"getImages",page:g+1,filter:{showVideos:!0,showPhotos:!0}}).then(t=>{t&&t.length>0?(p([...t.reverse(),...u]),O(!1),t.length<25&&L(!0)):L(!0)}),y(t=>t+1))},h=c=>{if(c){let l=u.filter(e=>e.src===c)[0];C("Camera",{action:"deleteFromGallery",links:l.src}).then(()=>{p(u.filter(e=>e.src!==c)),T(null),window.postMessage({action:"phone:updateStorage",add:!1,size:l.size})})}else C("Camera",{action:"deleteFromGallery",links:a.map(l=>l.src)}).then(()=>{p(u.filter(e=>!a.find(t=>e.src===t.src))),P([]);let l=0;a.forEach(e=>{l+=e.size}),window.postMessage({action:"phone:updateStorage",add:!1,size:l})})};return s("div",{className:"photos-container",children:d?s(R,{image:d,images:u,setActiveImage:T,handleDelete:h}):v("div",{className:"zoomOut",children:[v("div",{className:"photos-header",children:[s("div",{}),s("div",{className:"title",children:m("APPS.PHOTOS.TITLE")}),s("div",{className:"select",onClick:()=>S(!E),children:E?m("APPS.PHOTOS.CANCEL"):m("APPS.PHOTOS.SELECT")})]}),v("div",{className:"photos-content",onScroll:n,children:[!E&&s("div",{className:"info",children:m("APPS.PHOTOS.PHOTO_COUNT").format({count:u.length})}),s("div",{className:"images",ref:f,children:u.map((c,l)=>{let e=l===u.length-1?"last":"";return v("div",{id:e,className:"image",onClick:()=>{if(E){const t=a.find(o=>o.src===c.src);P(t?a.filter(o=>o.src!==c.src):[...a,c])}else T(c)},children:[c.isVideo?s($,{src:c.src,editMode:E}):s("div",{className:"img",style:{backgroundImage:`url(${c.src})`}}),s("div",{className:"checkbox",children:E&&(a.find(t=>t.src===c.src)?s(_,{checked:!0}):s(_,{checked:!1}))})]},l)})})]}),E&&v("div",{className:"photos-bottom",children:[s("span",{}),s("div",{className:"selected",children:a.length>0?m("APPS.PHOTOS.SELECTED_COUNT").format({count:a.length}):m("APPS.PHOTOS.SELECT_ITEMS")}),a.length>0?s(b,{onClick:()=>{N.PopUp.set({title:m("APPS.PHOTOS.DELETE_TITLE").format({count:a.length}),description:m("APPS.PHOTOS.DELETE_TEXT").format({count:a.length}),buttons:[{title:m("APPS.PHOTOS.DELETE_BUTTON_CANCEL")},{title:m("APPS.PHOTOS.DELETE_BUTTON_DELETE"),color:"red",cb:()=>{h()}}]})}}):s("span",{})]})]})})}const R=f=>{var l;const E=k(F),S=k(z.Settings),[a,P]=r.useState(new Date(((l=f==null?void 0:f.image)==null?void 0:l.timestamp)/1e3)),[d,T]=r.useState(!0),[u,p]=r.useState(0),g=r.useRef(null),y=r.useRef(null),[i,O]=r.useState(f.image),[M,L]=r.useState([]);let n=f.images;r.useEffect(()=>{if(i&&i.isVideo){const e=document.getElementById(i.src);if(!e)return;e.volume=S.sound.volume}},[S.sound.volume]),r.useEffect(()=>{var t;let e=n.findIndex(o=>o.src===i.src);if(p(e),i.isVideo){const o=document.getElementById(i.src);if(!o)return;o.play(),o.volume=S.sound.volume}if(n.length>0){let o=[];e===0?o=n.slice(0,12):e===n.length-1?o=n.slice(n.length-12,n.length):e<6?o=n.slice(0,12):e>n.length-6?o=n.slice(n.length-12,n.length):o=n.slice(e-6,e+6),P(new Date(((t=n==null?void 0:n[e])==null?void 0:t.timestamp)/1e3)),L(o)}},[i]);const h={pos:{startLeft:0,startX:0},onMouseDown:e=>{h.pos={startLeft:g.current.scrollLeft,startX:e.clientX},g.current.style.userSelect="none",document.addEventListener("mouseup",h.onMouseUp),document.addEventListener("mousemove",h.onMove)},onMove:e=>{if(!g.current)return;const t=(e.clientX-h.pos.startX)/A();g.current.scrollLeft=h.pos.startLeft-t;const o=g.current.getBoundingClientRect();(o.left*A()-5>e.clientX||e.clientX>o.right*A()-5)&&h.onMouseUp()},onMouseUp:()=>{if(!g.current)return;g.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",h.onMouseUp),document.removeEventListener("mousemove",h.onMove);const e=g.current.clientWidth;let t=u;const o=g.current.scrollLeft-h.pos.startLeft;if(o>e/2&&t<n.length?t++:o<-e/2&&t>0&&t--,i.src!==n[t].src&&i.isVideo){const w=document.getElementById(i.src);w&&(w.pause(),w.currentTime=0)}O(n[t]),document.getElementById(n[t].src).scrollIntoView({behavior:"smooth",block:"center"})}},c=e=>{i.isVideo&&document.getElementById(i.src).pause(),O(e),document.getElementById(e.src).scrollIntoView({behavior:"smooth",block:"center"})};return v("div",{className:"activephoto-container",children:[s(D,{children:d&&v(V.div,{className:"photo-top",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[s("div",{className:"back",onClick:()=>{N.Share.reset(),f.setActiveImage(null)},children:s(U,{})}),v("div",{className:"date",children:[a.toLocaleString([],{day:"2-digit",month:"long"}),s("span",{children:a.toLocaleTimeString(E.DateLocale,{hour:"numeric",minute:"numeric",hour12:S.time.twelveHourClock})})]}),s("div",{})]})}),s("div",{className:"image-overflow",ref:g,onMouseDown:h.onMouseDown,onClick:()=>T(!d),children:n.map((e,t)=>{const o=e.src===i.src;return e.isVideo?s("video",{src:e.src,className:o?"active":null,id:e.src,crossOrigin:"anonymous",loop:!0,onLoadedMetadata:I=>{o&&(I.target.scrollIntoView({block:"center"}),I.target.play())}},t):s(X,{ignoreStreamerMode:!0,id:e.src,src:e.src,className:o?"active":null,onLoad:I=>{o&&I.target.scrollIntoView({block:"center"})}},t)})}),s(D,{children:d&&v(V.div,{className:"photo-bottom-wrapper",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[s("div",{className:"photo-carousel",ref:y,children:M.map((e,t)=>e.isVideo?s("video",{src:e.src,"data-carousel":t,controls:!1,muted:!0,onClick:o=>c(e)},t):s("img",{src:e.src,"data-carousel":t,onClick:o=>c(e)},t))}),v("div",{className:"photo-bottom",children:[s(x,{onClick:()=>{N.Share.set({type:"image",data:{src:i.src,isVideo:i.isVideo}})}}),s(b,{onClick:()=>{N.PopUp.set({title:m("APPS.PHOTOS.DELETE_IMAGE_TITLE"),description:m("APPS.PHOTOS.DELETE_IMAGE_TEXT"),buttons:[{title:m("APPS.PHOTOS.DELETE_IMAGE_BUTTON_CANCEL")},{title:m("APPS.PHOTOS.DELETE_IMAGE_BUTTON_DELETE"),color:"red",cb:()=>{f.handleDelete(f.image.src)}}]})}})]})]})})]})},$=({src:f,editMode:E})=>{const[S,a]=r.useState(null);return v(H,{children:[s("video",{src:f,crossOrigin:"anonymous",controls:!1,onMouseOver:d=>d.currentTarget.play(),onMouseOut:d=>d.currentTarget.pause(),muted:!0,onLoadedMetadata:d=>{a(d.currentTarget.duration)}}),S&&!E&&s("div",{className:"video-duration",children:(d=>{const T=Math.floor(d/60),u=G(d-T*60,0);return`${T}:${u<10?"0"+u:u}`})(S)})]})};export{J as default};
