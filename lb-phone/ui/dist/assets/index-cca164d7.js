var N=Object.defineProperty;var V=(n,o,r)=>o in n?N(n,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[o]=r;var y=(n,o,r)=>(V(n,typeof o!="symbol"?o+"":o,r),r);import{r as h,j as m,R as w,F as C,a as x}from"./jsx-runtime-f40812bf.js";import{r as R}from"./index-0dd4a6fb.js";import{f as g,d as a,u as v,$ as E,P as $,a as k}from"./Phone-eb89da6c.js";import"./number-28525126.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const e of c.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&l(e)}).observe(document,{childList:!0,subtree:!0});function r(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerpolicy&&(c.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?c.credentials="include":i.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(i){if(i.ep)return;i.ep=!0;const c=r(i);fetch(i.href,c)}})();var P={},S=R;P.createRoot=S.createRoot,P.hydrateRoot=S.hydrateRoot;const L=()=>{const[n,o]=h.useState(null);return h.useEffect(()=>{g("voice:getConfig").then(r=>{if(!r)return a("error","VoiceProvider: No config found");o(r)})},[]),n!=null&&n.recordNearbyVoices?m(b,{config:n}):null},b=({config:n})=>{const o=h.useRef(null),[r,l]=h.useState([]),i=()=>new Promise((e,t)=>{var s;if(o.current)return e(o.current);(s=navigator.mediaDevices)==null||s.getUserMedia({audio:{autoGainControl:!1,noiseSuppression:!1,echoCancellation:!1}}).then(u=>{a("info","VoiceProvider: Got audio stream"),o.current=u,g("isTalking").then(d=>{c(!d)}),e(u)})}),c=e=>{if(!o.current)return a("warning","VoiceProvider: No audio stream");a("info",`VoiceProvider: ${e?"muting":"umuting"} audio stream`),r.forEach(t=>{t.gainNode.gain.value=e?0:t.volume,a("info",`VoiceProvider: Set volume to ${e?0:t.volume} for channel ${t.id}`)})};return v("camera:toggleMicrophone",e=>{c(!e)}),h.useEffect(()=>{var e;r.length===0&&((e=o.current)==null||e.getTracks().forEach(t=>t.stop()),o.current=null,a("info","VoiceProvider: Stopped audio stream"))},[r]),v("voice:joinChannel",async e=>{if(await i(),!o.current)return a("warning","VoiceProvider: No audio stream");if(r.find(f=>f.id===e.channel))return a("warning","VoiceProvider: Already connected to channel "+e.channel);a("info","Joining voice channel "+JSON.stringify(e));let t=new AudioContext,s=t.createMediaStreamSource(o.current),u=t.createMediaStreamDestination(),d=t.createGain();d.gain.value=e.volume,s.connect(d),d.connect(u),g("isTalking").then(f=>{f||(d.gain.value=0)});const p=n!=null&&n.ice?new E({config:{iceTransportPolicy:"relay",iceServers:n==null?void 0:n.ice}}):new E;p.on("open",()=>{p.call(e.channel,u.stream),l(f=>[...f,{id:e.channel,volume:e.volume,peer:p,gainNode:d,audioCtx:t}])})}),v("voice:leaveChannel",e=>{a("info","Leaving voice channel "+e);const t=r.find(s=>s.id===e);if(!t)return a("warning","VoiceProvider: Not connected to channel "+e);t.audioCtx.close(),t.peer.destroy(),l(s=>s.filter(u=>u.id!==e))}),v("voice:setVolume",e=>{a("info","Setting volume for channel "+e.channel+" to "+e.volume);const t=r.find(s=>s.id===e.channel);if(!t)return a("warning","VoiceProvider: Not connected to channel "+e.channel);t.gainNode.gain.value=e.volume,l(s=>s.map(u=>u.id===e.channel?{...u,volume:e.volume}:u))}),null};class M extends w.Component{constructor(){super(...arguments);y(this,"state",{hasError:!1})}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,l){this.logError(r,l)}logError(r,l){console.error("Phone crashed:",r,l),g("logError",{error:r.message,stack:r.stack,componentStack:l.componentStack})}render(){return this.state.hasError?(window.location.reload(),null):this.props.children}}P.createRoot(document.getElementById("root")).render(m(C,{children:x(M,{children:[m($,{children:m(k,{})}),m(L,{})]})}));
