import{r as a,a as s,j as e,F as Y}from"./jsx-runtime-f40812bf.js";import{s as Ve,b as se,$ as Ce,d as q,aB as _e,f as P,S as me,u as Z,C as z,L as i,Q as re,b8 as be,M as Pe,by as Re,k as te,h as ve,a2 as Se,c as ce,O as ae,ax as Fe,X as ge,F as Ue,az as he,bz as Me,W as ie,v as ne,a7 as oe,ab as ke,x as Ae,I as Ne,bA as De,bB as xe,a8 as We,Z as Te,_ as we,au as Be,bC as He,bv as $e,E as je,aG as Ye}from"./Phone-eb89da6c.js";import{r as ze}from"./number-28525126.js";import{C as qe}from"./Check-b689eec4.js";import{formatNumber as Xe}from"./Tiktok-17be138c.js";import"./Switch-fda1986a.js";import"./Slider-bafc11cd.js";const ee=Ve({host:"",participants:[],viewers:0});function Ke(){var H,Q,le,ue;const{View:n,Account:h,Func:E}=a.useContext(X),[o,S]=n,[d]=h,m=se(ve),u=se(ee),[v,A]=a.useState(!1),[l,t]=a.useState(!1),[N,R]=a.useState(null),[_,p]=a.useState(""),C=a.useRef(null),G=a.useRef(null),b=a.useRef(null),[F,L]=a.useState(null),[y,k]=a.useState(null),[D,x]=a.useState(null),[c,r]=a.useState([]),[I,w]=a.useState([]),[f,U]=a.useState([]);a.useEffect(()=>{C.current.scrollTop=C.current.scrollHeight},[f]),a.useEffect(()=>{const T=m.ice?new Ce({config:{iceTransportPolicy:"relay",iceServers:m.ice}}):new Ce;return T.on("open",g=>{L({peer:T,id:g})}),T.on("call",g=>{g.on("close",()=>{w(O=>O.filter(W=>W.connectionId!==g.connectionId))}),w(O=>[...O,g])}),q("info","Created peer"),()=>{try{for(let g of I)g.close()}catch{q("error","Failed to close calls")}try{T.destroy()}catch{q("error","Failed to destroy peer")}}},[]),a.useEffect(()=>{if(!D||b!=null&&b.current||!F)return;q("info","Creating game render");let T=new _e(D);b.current=T,T.resizeByAspect(3/4);const g=window.innerWidth;g>1280&&T.setQuality(1280/g);let O;if(y||v){q("info","Host is true, creating call"),v?P("Instagram",{action:"setLive",username:d.username,verified:d.verified,id:F.id}):y&&P("Instagram",{action:"joinLive",username:y,streamId:F.id}).then(j=>{if(k(null),!j)return q("error","Failed to join live");t(!0)});const W=D.captureStream(24);O=j=>{q("info","Answering call",j),j.answer(W)},F.peer.on("call",O)}return()=>{O&&F.peer.off("call",O),b.current&&b.current.destroy(),b.current=null}},[D,F]);const M=T=>{T.forEach(g=>{if(g.username===d.username)return q("info","Skipping self");q("info","Adding participant",g);const O=document.createElement("canvas"),W=O.captureStream(0),j=F.peer.call(g.id,W);w(J=>[...J,j]),j.on("close",O.remove),j.on("error",O.remove),j.on("stream",J=>{P("Instagram",{action:"addCall",id:j.connectionId,username:g.username}),r(fe=>[...fe,{stream:J,username:g.username}])})})},$=T=>{T.forEach(g=>{q("info","Removing participant",g),g.username===d.username&&t(!1),r(O=>O.filter(W=>W.username!==g.username))})};a.useEffect(()=>{const T=u.participants;if(!T||!F)return q("warning","No participants");const g=T.filter(W=>!c.find(j=>j.username===W.username));g.length&&M(g),q("info","Added",g);const O=c.filter(W=>!T.find(j=>j.username===W.username));O.length&&$(O),q("info","Removed",O)},[u.participants,F]),a.useEffect(()=>{const T=d.username===(u==null?void 0:u.host);if(A(T),me.ShouldClose.set(!1),!!T)return r(g=>[...g,{username:u.host}]),()=>{me.ShouldClose.set(!0)}},[]);const B=()=>{z.PopUp.set({title:v?i("APPS.INSTAGRAM.END_LIVE_POPUP.TITLE"):i("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:i("APPS.INSTAGRAM.END_LIVE_POPUP.DESCRIPTION").format({action:(v?i("APPS.INSTAGRAM.END_LIVE_POPUP.END"):i("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE")).toLowerCase()}),buttons:[{title:i("APPS.INSTAGRAM.END_LIVE_POPUP.CANCEL")},{title:v?i("APPS.INSTAGRAM.END_LIVE_POPUP.END"):i("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{V(v)}}]})},K=()=>{P("Instagram",{action:"sendLiveMessage",data:{user:{username:d.username,avatar:d.avatar,verified:d.verified},live:u.host,content:_}}),p("")},V=(T,g)=>{if(v)P("Instagram",{action:"endLive"}).then(()=>{S("feed")});else if(l&&P("Instagram",{action:"endLive"}).then(()=>{S("feed")}),P("Instagram",{action:"stopViewing",username:u.host}),T)me.ShouldClose.set(!0),ee.patch({ended:!0});else{if(g===!1)return;S("feed")}};return Z("instagram:addMessage",T=>{T.live===u.host&&U(g=>[...g,T])}),Z("instagram:updateViewers",T=>{T.username===(u==null?void 0:u.host)&&ee.patch({viewers:T.viewers})}),Z("instagram:setLive",T=>{ee.set(T)}),Z("instagram:liveEnded",T=>{T===(u==null?void 0:u.host)&&V(!0)}),Z("instagram:stopLive",()=>S("feed")),Z("instagram:endCall",T=>{const g=I.find(O=>O.connectionId===T);g&&(g.close(),w(O=>O.filter(W=>W.connectionId!==T)))}),Z("instagram:invitedLive",T=>{T===(u==null?void 0:u.host)&&z.PopUp.set({title:i("APPS.INSTAGRAM.INVITE_LIVE_POPUP.TITLE"),description:i("APPS.INSTAGRAM.INVITE_LIVE_POPUP.DESCRIPTION").format({username:T}),buttons:[{title:i("APPS.INSTAGRAM.INVITE_LIVE_POPUP.NO")},{title:i("APPS.INSTAGRAM.INVITE_LIVE_POPUP.YES"),cb:()=>{k(T),r(g=>[...g,{username:d.username}])}}]})}),Z("instagram:joinedLive",T=>{T.host===(u==null?void 0:u.host)&&ee.patch({participants:[...u.participants,T]})}),Z("instagram:leftLive",T=>{T.host===(u==null?void 0:u.host)&&(q("info","left live",T),ee.patch({participants:u.participants.filter(g=>g.username!==T.participant)}))}),s("div",{className:"instagram-live-container",children:[e("div",{className:"instagram-streams","data-streams":c.length.toString(),children:c.map((T,g)=>T.username===d.username?s("div",{className:"instagram-stream",children:[e("canvas",{ref:O=>{q("info","setting canvas ref",O),x(O)}}),!v&&e(re,{onClick:()=>{z.PopUp.set({title:i("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:i("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{P("Instagram",{action:"endLive"}),t(!1)}}]})}})]}):e(Je,{host:v,stream:T.stream,username:T.username},`stream-${g}`))}),u.ended&&s("div",{className:"instagram-stream-ended",children:[e(be,{onClick:()=>S("feed")}),e("div",{className:"title",children:i("APPS.INSTAGRAM.LIVE_ENDED")})]}),e(Pe,{children:N&&e(Ze,{username:u.host,type:N,host:N==="participants"?v||l:v,endLive:V,close:()=>R(null)})}),s("div",{className:"instagram-live",children:[s("div",{className:"live-header",children:[s("div",{className:"profile",onClick:()=>{c.length>1?R("participants"):!v&&!l&&(V(),E.fetchAndSetProfile(u.host))},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${((Q=(H=u==null?void 0:u.participants)==null?void 0:H[0])==null?void 0:Q.avatar)??"./assets/img/icons/instagram/unknown-pfp.jpg"})`}}),s("div",{className:"name",children:[e(Qe,{usernames:u.participants.map(T=>T.username)}),((ue=(le=u==null?void 0:u.participants)==null?void 0:le[0])==null?void 0:ue.verified)&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(Re,{})]})]}),s("div",{className:"stats",children:[e("div",{className:"live",children:i("APPS.INSTAGRAM.LIVE")}),s("div",{className:"viewers",onClick:()=>R("viewers"),children:[e("i",{className:"fas fa-eye"}),u.viewers]}),e("i",{className:"far fa-times x",onClick:()=>{v||l?B():V(!1)}})]})]}),s("div",{className:"comment-section",children:[e("div",{className:"comment-feed",ref:C,children:f.map((T,g)=>{let O=T.user.avatar??"./assets/img/icons/instagram/unknown-pfp.jpg";return s("div",{className:"comment",children:[e("img",{src:O}),s("div",{className:"info",children:[s("div",{className:"name",children:[T.user.username,T.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"comment-text",children:T.content})]})]},g)})}),s("div",{className:"comment-input",children:[e(te,{type:"text",ref:G,placeholder:i("APPS.INSTAGRAM.COMMENT_PLACEHOLDER"),onChange:T=>p(T.target.value),onKeyDown:T=>{T.key==="Enter"&&_.replace(/ /g,"").length>0&&(K(),G.current.value="")}}),e("i",{className:"far fa-paper-plane",onClick:()=>{_.replace(/ /g,"").length>0&&(K(),G.current.value="")}}),(v||l)&&e("i",{className:"fas fa-repeat",onClick:()=>{P("Instagram",{action:"flipCamera"})}})]})]})]})]})}const Je=n=>{const h=a.useRef(null);return a.useEffect(()=>{if(!(h!=null&&h.current))return q("warning","No video ref");h.current.srcObject=n.stream,h.current.play()},[n==null?void 0:n.stream]),s("div",{className:"instagram-stream",children:[n.host&&e(re,{onClick:()=>{z.PopUp.set({title:i("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:n.username}),description:i("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:n.username}),buttons:[{title:i("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{P("Instagram",{action:"removeLive",username:n.username}).then(()=>{})}}]})}}),e("video",{autoPlay:!0,ref:h})]})},Qe=n=>{let h=n.usernames.map((E,o)=>E).join(", ");return h.length>11&&(h=h.substring(0,11)+"...",h[h.length-3]===","&&(h=h.substring(0,h.length-3)+"...")),e(Y,{children:h})},Ze=n=>{var d;const{Func:h}=a.useContext(X),E=(d=se(ee))==null?void 0:d.participants,[o,S]=a.useState([]);return a.useEffect(()=>{var m;if(n.type==="participants"){S((m=ee.value)==null?void 0:m.participants);return}P("Instagram",{action:"getLiveViewers",username:n.username}).then(u=>{u&&S(u)})},[]),s(Se.div,{className:"story-modal","data-type":"live",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[s("div",{className:"story-modal-header",children:[e("div",{className:"close-border",onClick:()=>n.close()}),e("div",{className:"title",children:n.type==="viewers"?i("APPS.INSTAGRAM.WHOS_WATCHING"):i("APPS.INSTAGRAM.IN_THIS_ROOM")})]}),e("div",{className:"story-modal-content",children:e("div",{className:"viewers",children:o.map((m,u)=>s("div",{className:"item",children:[s("div",{className:"user",onClick:()=>{n.host||(n.endLive(!1,!1),h.fetchAndSetProfile(m.username))},children:[e("div",{className:"profile-picture",children:e("img",{src:h.getAvatar(m.avatar)})}),s("div",{className:"user-details",children:[s("div",{className:"username",children:[m.username,m.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:m.name})]})]}),n.host&&n.type==="viewers"&&(E.find(v=>v.username===m.username)?e("div",{className:"remove",onClick:v=>{v.stopPropagation(),z.PopUp.set({title:i("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:m.username}),description:i("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:m.username}),buttons:[{title:i("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{P("Instagram",{action:"removeLive",username:m.username}).then(()=>{})}}]})},children:i("APPS.INSTAGRAM.REMOVE")}):e("div",{className:"invite",onClick:v=>{v.stopPropagation(),P("Instagram",{action:"inviteLive",username:m.username})},children:i("APPS.INSTAGRAM.INVITE")}))]},u))})})]})};function Oe(n){const h=se(ce.Settings);return e(Y,{children:n.liked?e("svg",{onClick:n.onClick,color:"#ed4956",fill:"#ed4956",height:"24",viewBox:"0 0 48 48",width:"24",children:e("path",{d:"M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"})}):e("svg",{onClick:n.onClick,color:h.display.theme==="dark"?"#ffffff":"#262626",fill:h.display.theme==="dark"?"#ffffff":"#262626",height:"24",viewBox:"0 0 24 24",width:"24",children:e("path",{d:"M16.792 3.904A4.989 4.989 0 0121.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 014.708-5.218 4.21 4.21 0 013.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 013.679-1.938m0-2a6.04 6.04 0 00-4.797 2.127 6.052 6.052 0 00-4.787-2.127A6.985 6.985 0 00.5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 003.518 3.018 2 2 0 002.174 0 45.263 45.263 0 003.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 00-6.708-7.218z"})})})}function Ge(n){const{Account:h,View:E,Func:o,UserPanel:S}=a.useContext(X);se(ce.Settings);const[d]=h,[m,u]=E,[v,A]=S,[l,t]=a.useState(n.data),N=a.useRef(null);a.useRef(null);const[R,_]=a.useState(0),[p,C]=a.useState(!1),G={pos:{startLeft:0,startX:0},onMouseDown:L=>{G.pos={startLeft:N.current.scrollLeft,startX:L.clientX},N.current.style.userSelect="none",document.addEventListener("mouseup",G.onMouseUp),document.addEventListener("mousemove",G.onMove)},onMove:L=>{const y=(L.clientX-G.pos.startX)/he();N.current.scrollLeft=G.pos.startLeft-y;const k=N.current.getBoundingClientRect();(k.left*he()-5>L.clientX||L.clientX>k.right*he()-5)&&G.onMouseUp()},onMouseUp:()=>{N.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",G.onMouseUp),document.removeEventListener("mousemove",G.onMove);const L=JSON.parse(l.media),y=N.current.clientWidth;let k=R;const D=N.current.scrollLeft-G.pos.startLeft;D>y/2&&k<L.length-1?k++:D<-y/2&&k>0&&k--,b(k)}},b=L=>{N.current.scrollTo({left:L*N.current.offsetWidth,behavior:"smooth"}),_(L)};Z("instagram:setLikes",L=>{L.postId!==l.id||L.isComment||t({...l,like_count:L.likes})});const F=L=>{if(L.detail===2){if(!l.id)return;l.liked||P("Instagram",{action:"toggleLike",data:{postId:l.id,toggle:!l.liked,isComment:!1}}).then(y=>{t({...l,liked:y.liked,like_count:y.likes})}),C(!0),setTimeout(()=>{C(!1)},1e3)}};return s("div",{className:"post",id:n.last?"last":"","data-id":l.id,"data-active":n.active,children:[s("div",{className:"post-header",children:[e("img",{className:"profile-picture",onClick:()=>{o.fetchAndSetProfile(l.username)},src:o.getAvatar(l.avatar)}),s("div",{className:"post-info",children:[s("div",{className:"name",onClick:()=>o.fetchAndSetProfile(l.username),children:[l.username,l.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),l.location&&e("div",{className:"location",children:l.location})]})]}),s("div",{className:"post-body",children:[p&&e("div",{className:`popup-heart ${p?"show":"hide"}`,children:e("svg",{color:"#e3e3e3",fill:"#e3e3e3",height:"24",viewBox:"0 0 48 48",width:"24",children:e("path",{d:"M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"})})}),e("div",{className:"image-container",ref:N,onMouseDown:G.onMouseDown,children:JSON.parse(l.media).map((L,y)=>e("div",{className:"image",onClick:F,children:ae(L)?e(et,{attachment:L,active:n.active}):e("img",{src:L})},y))}),s("div",{className:"actions",children:[s("div",{className:"like-comment",children:[e(Oe,{liked:l.liked,onClick:()=>{l.id&&P("Instagram",{action:"toggleLike",data:{postId:l.id,toggle:!l.liked,isComment:!1}}).then(L=>{t({...l,liked:L.liked,like_count:L.likes})})}}),e("svg",{onClick:()=>o.fetchAndSetComments({id:l.id,username:l.username,avatar:l.avatar,verified:l.verified,caption:l.caption,timestamp:l.timestamp}),color:"#262626",fill:"#262626",height:"24",viewBox:"0 0 24 24",width:"24",children:e("path",{d:"M20.656 17.008a9.993 9.993 0 10-3.59 3.615L22 22z",fill:"none",stroke:"currentColor",strokeWidth:"2px"})}),(l.username===d.username||d.isAdmin)&&e(Fe,{onClick:()=>{z.PopUp.set({title:i("APPS.INSTAGRAM.DELETE_POST_POPUP.TITLE"),description:i("APPS.INSTAGRAM.DELETE_POST_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.INSTAGRAM.DELETE_POST_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.DELETE_POST_POPUP.PROCEED"),color:"red",cb:()=>{P("Instagram",{action:"deletePost",id:l.id}).then(L=>{L&&u("feed")})}}]})}})]}),JSON.parse(l.media).length>1&&e("div",{className:"scroll-dots",children:JSON.parse(l.media).map((L,y)=>e("div",{className:`dot ${R==y?"active":""}`,onClick:()=>b(y)},y))})]}),s("div",{className:"liked-by",onClick:()=>{A({display:!0,data:{title:i("APPS.INSTAGRAM.LIKED_BY"),postId:l.id,cb:()=>{u("feed")}}})},children:[l.like_count," ",i("APPS.INSTAGRAM.LIKES")]}),s("div",{className:"caption",children:[e("span",{className:"user",onClick:L=>{L.stopPropagation(),o.fetchAndSetProfile(l.username)},children:l.username}),ge(l.caption)," "]}),e("div",{className:"comments",onClick:L=>{L.stopPropagation(),o.fetchAndSetComments({id:l.id,username:l.username,avatar:l.avatar,verified:l.verified,caption:l.caption,timestamp:l.timestamp})},children:l.comment_count>0?i("APPS.INSTAGRAM.VIEW_ALL_COMMENTS").format({count:l.comment_count}):i("APPS.INSTAGRAM.FIRST_COMMENT")}),e("div",{className:"date",children:Ue(l.timestamp)})]})]})}const et=n=>{var d;const[h,E]=a.useState(n.active),o=se(ce.Settings),S=a.useRef(null);return a.useEffect(()=>{var m;E(n.active),!(!S.current||!((m=o==null?void 0:o.sound)!=null&&m.volume))&&n.active&&(S.current.volume=o.sound.volume,S.current.currentTime=0)},[n.active]),a.useEffect(()=>{var m;!S.current||!((m=o==null?void 0:o.sound)!=null&&m.volume)||n.active&&(S.current.volume=o.sound.volume)},[(d=o==null?void 0:o.sound)==null?void 0:d.volume]),e("video",{src:n.attachment,autoPlay:!0,loop:!0,muted:!n.active,ref:S,onLoadedMetadata:m=>{n.active&&(m.currentTarget.volume=o.sound.volume)}})};function tt(){const{Account:n,View:h,Func:E,Stories:o}=a.useContext(X),[S,d]=h,[m]=n,[u,v]=a.useState([]),[A,l]=a.useState([]),[t,N]=o,[R,_]=a.useState(0),[p,C]=a.useState(!1),[G,b]=a.useState(!1),[F,L]=a.useState(null);a.useEffect(()=>{P("Instagram",{action:"getPosts",filters:{following:!0},page:0}).then(c=>{c&&v(c)})},[]),a.useEffect(()=>{S==="feed"&&(P("Instagram",{action:"getLives"}).then(c=>{c&&l(c)}),P("Instagram",{action:"getStories"}).then(c=>{c&&N([...c.sort((r,I)=>{if(r.seen===I.seen)return 0;if(r.seen===1)return 1;if(I.seen===1)return-1})])}))},[S]);const y=new IntersectionObserver(k,{rootMargin:"20px",threshold:.5});function k(c){c.forEach(r=>{if(r.isIntersecting){let w=r.target.getAttribute("data-id");L(w)}})}const D=()=>{if(p||G)return;let c=document.querySelector("#last");if(!c)return;document.querySelectorAll(".post").forEach(w=>y.observe(w)),!ie(c)&&(b(!0),P("Instagram",{action:"getPosts",filters:{following:!0},page:R+1}).then(w=>{w&&w.length>0?(v([...u,...w]),b(!1)):C(!0)}),_(w=>w+1))};a.useEffect(()=>{const c=document.querySelector(".stories");return c.addEventListener("wheel",r=>{r.preventDefault(),c.scrollLeft+=r.deltaY}),()=>{c.removeEventListener("wheel",r=>{r.preventDefault(),c.scrollLeft+=r.deltaY})}},[]),Z("instagram:updateLives",c=>{c&&l(c)});const x=()=>{z.PopUp.set({title:i("APPS.INSTAGRAM.GO_LIVE_POPUP.TITLE"),description:i("APPS.INSTAGRAM.GO_LIVE_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.INSTAGRAM.GO_LIVE_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.GO_LIVE_POPUP.PROCEED"),color:"red",cb:()=>{P("Instagram",{action:"goLive",user:{username:m.username,avatar:E.getAvatar(m==null?void 0:m.avatar),verified:m.verified}}).then(c=>{if(!c)return q("error","Failed to go live");ee.set({host:m.username,participants:[{username:m.username,name:m.username,avatar:E.getAvatar(m==null?void 0:m.avatar),verified:m.verified}],viewers:0}),d("live")})}}]})};return s(Y,{children:[s("div",{className:"instagram-header feed-header",children:[s("div",{className:"name",children:[m.username,m.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),s("svg",{onClick:()=>d("dmList"),color:"#262626",fill:"#262626",height:"24",role:"img",viewBox:"0 0 24 24",width:"24",children:[e("line",{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"2",x1:"22",x2:"9.218",y1:"3",y2:"10.083"}),e("polygon",{fill:"none",points:"11.698 20.334 22 3.001 2 3.001 9.218 10.084 11.698 20.334",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"2"})]})]}),s("div",{className:"feed",onScroll:D,children:[e("div",{className:"stories-wrapper",children:s("div",{className:"stories",children:[s("div",{className:"story self",onClick:()=>{z.ContextMenu.set({buttons:[{title:i("APPS.INSTAGRAM.GO_LIVE"),cb:()=>x()},{title:i("APPS.INSTAGRAM.CREATE_STORY"),cb:()=>{var c,r,I;z.Gallery.set({includeVideos:!0,allowExternal:(I=(r=(c=ve)==null?void 0:c.value)==null?void 0:r.AllowExternal)==null?void 0:I.Instagram,onSelect:w=>{P("Instagram",{action:"addToStory",media:w.src}).then(f=>{f&&N([{username:m.username,avatar:m.avatar,verified:m.verified,seen:0,id:f},...t.filter(U=>U.username!==m.username)])})}})}}]})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${E.getAvatar(m==null?void 0:m.avatar)})`},children:e("div",{className:"plus",children:e("i",{className:"far fa-plus"})})}),e("div",{className:"name",children:i("APPS.INSTAGRAM.YOUR_STORY")})]}),Object.keys(A).map((c,r)=>{var I;return s("div",{className:"story",onClick:()=>{var w;P("Instagram",{action:"viewLive",username:((w=A[c])==null?void 0:w.participant)??c}).then(f=>{var $,B,K,V;if(!f)return q("error","Failed to view live, perhaps it ended?");let U=($=A[c])!=null&&$.participant?A[(B=A[c])==null?void 0:B.participant]:A[c],M=(U==null?void 0:U.participants)??[];M.unshift({username:((K=A[c])==null?void 0:K.participant)??c,name:U.name,avatar:U.avatar,verified:U.verified,id:U.id}),ee.set({host:((V=A[c])==null?void 0:V.participant)??c,participants:M,viewers:f}),d("live")})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${E.getAvatar((I=A[c])==null?void 0:I.avatar)})`},children:e("img",{className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.png"})}),e("div",{className:"name",children:c})]},r)}),t.map((c,r)=>s("div",{className:"story",onClick:I=>{let[w,f]=Me(I);E.fetchAndSetStory(c,null,{x:w,y:f})},children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${E.getAvatar(c==null?void 0:c.avatar)})`},children:e("img",{className:"circle","data-seen":c.seen===1,src:"./assets/img/icons/instagram/StoryCircle.png"})}),e("div",{className:"name",children:c.username})]},r))]})}),u.length===0&&e("div",{className:"no-posts",children:i("APPS.INSTAGRAM.EMPTY_FEED")}),u.map((c,r)=>{let I=r===u.length-1;return e(Ge,{data:c,active:F===c.id,last:I},r)})]})]})}function Le(){const{View:n,Account:h,LoggedIn:E}=a.useContext(X),o=se(ce.Settings),[S,d]=a.useState(""),[m,u]=a.useState(""),[v,A]=a.useState(""),[l,t]=a.useState(!1),[N,R]=a.useState(!1),[_,p]=a.useState(!1),[C,G]=n,[b,F]=h,[L,y]=E,[k,D]=a.useState("login"),x=()=>{t(!1),R(!1),P("Instagram",{action:"logIn",username:m,password:v}).then(r=>{r.success&&r.account?(R(!1),t(!1),P("isAdmin").then(I=>{ne.APPS.INSTAGRAM.account.set(r.account),F({...r.account,isAdmin:I}),G("feed"),y(!0)})):r.error=="no account"?t(!0):r.error=="wrong password"?R(!0):console.log(r.error)})},c=()=>{let r=m.toLowerCase().replace(/\s/g,"");r.length<3||r.length>15||P("Instagram",{action:"createAccount",name:S,username:r,password:v}).then(I=>{I.success?(R(!1),t(!1),P("isAdmin").then(w=>{let f={name:S,username:r,posts:0,followers:0,following:0};ne.APPS.INSTAGRAM.account.set(f),F({...f,isAdmin:w}),G("feed"),y(!0)})):console.log("couldn't create account",I)})};return a.useEffect(()=>{R(!1),t(!1)},[k]),e("div",{className:"log-in",children:s(Y,{children:[e("div",{className:"wrapper",children:k==="login"?s(Y,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":o.display.theme}),s("div",{className:"form",children:[e(te,{placeholder:i("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:r=>u(r.target.value.replace(/\s/g,"")),maxLength:15}),l&&e("div",{className:"instagram-wrong",children:i("APPS.INSTAGRAM.NO_ACCOUNT")}),e(te,{placeholder:i("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:r=>A(r.target.value),maxLength:50}),N&&e("div",{className:"instagram-wrong",children:i("APPS.INSTAGRAM.WRONG_USERNAME_OR_PASSWORD")}),e("div",{className:"button",onClick:x,children:i("APPS.INSTAGRAM.LOG_IN")})]})]}):s(Y,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":o.display.theme}),s("div",{className:"form",children:[e(te,{placeholder:i("APPS.INSTAGRAM.NAME_PLACEHOLDER"),type:"text",onChange:r=>d(r.target.value),maxLength:20}),e(te,{placeholder:i("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:r=>u(r.target.value.replace(/\s/g,"")),maxLength:15}),_&&e("div",{className:"instagram-wrong",children:i("APPS.INSTAGRAM.ACCOUNT_WITH_USERNAME")}),e(te,{placeholder:i("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:r=>A(r.target.value),maxLength:50}),e("div",{className:"button",onClick:c,children:i("APPS.INSTAGRAM.CREATE_ACCOUNT")})]})]})}),e("div",{className:"footer",children:k==="login"?s(Y,{children:[i("APPS.INSTAGRAM.NOT_HAVE_ACCOUNT")," ",e("span",{onClick:()=>D("createAccount"),children:i("APPS.INSTAGRAM.CREATE_ACCOUNT")})]}):s(Y,{children:[i("APPS.INSTAGRAM.HAVE_ACCOUNT")," ",e("span",{onClick:()=>D("login"),children:i("APPS.INSTAGRAM.LOG_IN")})]})})]})})}function at(){const[n,h]=a.useState([]),[E,o]=a.useState(0),[S,d]=a.useState(!1),[m,u]=a.useState(!1);a.useEffect(()=>{P("Instagram",{action:"getNotifications"}).then(A=>{A&&h(A)})},[]);const v=()=>{if(S||m)return;let A=document.querySelector("#last");if(!A)return;!ie(A)&&(u(!0),P("Instagram",{action:"getNotifications",page:E+1}).then(t=>{t&&t.length>0?(h([...n,...t]),u(!1)):d(!0)}),o(t=>t+1))};return s("div",{className:"notifications-container",children:[e("div",{className:"notifications-header",children:i("APPS.INSTAGRAM.ACTIVITY")}),e("div",{className:"notifications-body",onScroll:v,children:n.map((A,l)=>{let t=l===n.length-1?"last":"";return e(st,{notification:A,last:t},l)})})]})}const st=({notification:n,last:h})=>{const{Account:E,Func:o}=a.useContext(X),[S]=E,[d,m]=a.useState(n.isFollowing);switch(n.type){case"like_photo":return s("div",{className:"notification-item",id:h,onClick:()=>o.fetchAndSetPost(n.postId),children:[s("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(n.avatar),onClick:v=>{v.stopPropagation(),o.fetchAndSetProfile(n.username)}}),s("div",{className:"content",children:[e("span",{children:n.username})," ",i("APPS.INSTAGRAM.LIKED_PHOTO"),e("span",{className:"date",children:oe(n.timestamp)})]})]}),ae(n.photo)?e("video",{className:"post-preview",src:n.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:n.photo})]});case"like_comment":return e("div",{className:"notification-item",id:h,onClick:()=>o.fetchAndSetPost(n.postId,!0),children:s("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(n.avatar),onClick:v=>{v.stopPropagation(),o.fetchAndSetProfile(n.username)}}),s("div",{className:"content",children:[e("span",{children:n.username})," ",i("APPS.INSTAGRAM.LIKED_COMMENT").format({comment:n.comment}),e("span",{className:"date",children:oe(n.timestamp)})]})]})});case"comment":return s("div",{className:"notification-item",id:h,onClick:()=>o.fetchAndSetPost(n.postId,!0),children:[s("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(n.avatar),onClick:v=>{v.stopPropagation(),o.fetchAndSetProfile(n.username)}}),s("div",{className:"content",children:[e("span",{children:n.username})," ",i("APPS.INSTAGRAM.COMMENTED").format({comment:n.comment}),e("span",{className:"date",children:oe(n.timestamp)})]})]}),ae(n.photo)?e("video",{className:"post-preview",src:n.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:n.photo})]});case"follow":return s("div",{className:"notification-item",id:h,onClick:()=>o.fetchAndSetProfile(n.username),children:[s("div",{className:"notification-body",children:[e("img",{className:"avatar",src:o.getAvatar(n.avatar),onClick:()=>o.fetchAndSetProfile(n.username)}),s("div",{className:"content",children:[e("span",{children:n.username})," ",i("APPS.INSTAGRAM.FOLLOWED"),e("span",{className:"date",children:oe(n.timestamp)})]})]}),e("div",{className:`button ${d?"following":"follow"}`,onClick:v=>{v.stopPropagation(),S.username!==n.username&&(d?z.PopUp.set({title:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:n.username}),buttons:[{title:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{P("Instagram",{action:"toggleFollow",data:{username:n.username,following:!d}}).then(()=>{m(A=>!A)})}}]}):P("Instagram",{action:"toggleFollow",data:{username:n.username,following:!d}}).then(()=>{m(A=>!A)}))},children:d?i("APPS.INSTAGRAM.FOLLOWING"):i("APPS.INSTAGRAM.FOLLOW")})]})}};function nt(){const{View:n,Profile:h,Account:E,Func:o,GoBack:S,Post:d,UserPanel:m,LoggedIn:u,Dm:v}=a.useContext(X),[A,l]=n,[t,N]=h,[R,_]=u,[p,C]=E,[G,b]=d,[F,L]=v,[y,k]=m,[D,x]=S,[c,r]=a.useState(!1),[I,w]=a.useState(!1),[f,U]=a.useState(null),[M,$]=a.useState(0),[B,K]=a.useState(!1),[V,H]=a.useState(!1);a.useEffect(()=>{t.username&&(r(p.username===t.username),P("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:0}).then(g=>{g&&U(g)}))},[t]);const Q=()=>{if(B||V)return;let g=document.querySelector("#last");if(!g)return;!ie(g)&&(H(!0),P("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:M+1}).then(W=>{W&&W.length>0?(U([...f,...W]),H(!1)):K(!0)}),$(W=>W+1))},le=()=>{t.name&&P("Instagram",{action:"updateProfile",data:{name:t.name,bio:t.bio,avatar:t.avatar}}).then(g=>{g&&w(!1)})};Z("instagram:setFollowers",g=>{g.username===t.username&&N({...t,followers:g.followers})}),Z("instagram:setFollowing",g=>{g.username===t.username&&N({...t,following:g.following})});const ue=a.useRef(!0);a.useEffect(()=>{if(ue.current){ue.current=!1;return}P("Instagram",{action:"toggleFollow",data:{username:t.username,following:t.isFollowing}})},[t.isFollowing]);const T=()=>{P("AccountSwitcher",{action:"getAccounts",app:"Instagram"}).then(g=>{var j;if(!g)return q("info","No accounts found");let O=p.isAdmin,W=(j=g==null?void 0:g.filter(J=>J!==t.username))==null?void 0:j.map(J=>({title:J,cb:()=>{P("AccountSwitcher",{action:"switch",app:"Instagram",account:J}).then(fe=>{P("Instagram",{action:"isLoggedIn"}).then(de=>{de?(ne.APPS.INSTAGRAM.account.set(de),C({...de,isAdmin:O}),l("feed"),_(!0)):ne.APPS.INSTAGRAM.account.set(null)})})}}));z.ContextMenu.set({buttons:[{title:p.username},...W,{title:i("APPS.INSTAGRAM.ADD_ACCOUNT"),cb:()=>{_(!1)}}]})})};return e(Y,{children:t&&s("div",{className:"profile",children:[e(Pe,{children:I&&s(Se.div,{className:"edit-profile",initial:{y:750,opacity:.75},animate:{y:0,opacity:1},exit:{y:750,opacity:.75},transition:{duration:.3,ease:"easeInOut"},children:[s("div",{className:"edit-profile-header",children:[e("div",{className:"cancel",onClick:()=>w(!1),children:i("CANCEL")}),e("div",{className:"title",children:i("APPS.INSTAGRAM.EDIT_PROFILE")}),e("div",{className:"save",onClick:()=>le(),children:i("APPS.INSTAGRAM.DONE")})]}),s("div",{className:"edit-profile-body",children:[s("div",{className:"profile-picture",onClick:()=>{var g,O,W;z.Gallery.set({allowExternal:(W=(O=(g=ve)==null?void 0:g.value)==null?void 0:O.AllowExternal)==null?void 0:W.Instagram,onSelect:j=>{N({...t,avatar:j.src}),C({...p,avatar:j.src})}})},children:[e("img",{src:o.getAvatar(t.avatar),alt:"profile"}),e("span",{children:i("APPS.INSTAGRAM.CHANGE_PICTURE")})]}),s("div",{className:"profile-items",children:[s("div",{className:"item",children:[e("div",{className:"title",children:i("APPS.INSTAGRAM.NAME")}),e(te,{placeholder:i("APPS.INSTAGRAM.NAME_PLACEHOLDER"),onChange:g=>{N({...t,name:g.target.value})},maxLength:30,defaultValue:t.name})]}),s("div",{className:"item",children:[e("div",{className:"title",children:i("APPS.INSTAGRAM.BIO")}),e(ke,{placeholder:i("APPS.INSTAGRAM.BIO"),onChange:g=>{N({...t,bio:g.target.value})},maxLength:100,defaultValue:t.bio??""})]})]}),e("div",{className:"sign-out",onClick:()=>{z.PopUp.set({title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{P("Instagram",{action:"signOut"}).then(g=>{_(null),C(null),ne.APPS.INSTAGRAM.account.set(null)})}}]})},children:i("APPS.INSTAGRAM.SIGN_OUT")})]})]})}),c?e("div",{className:"instagram-header",children:s("div",{className:"name",style:{cursor:"pointer"},onClick:()=>T(),children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(Re,{})]})}):s("div",{className:"profile-header",children:[e("i",{className:"fas fa-chevron-left",onClick:()=>{D!=null&&D.cb?D.cb():l("feed")}}),s("div",{className:"name",children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("span",{})]}),s("div",{className:"profile-body",children:[s("div",{className:"profile-wrapper",children:[s("div",{className:"top",children:[s("div",{className:"profile-picture",style:{backgroundImage:`url(${o.getAvatar(t.avatar)})`},children:[t.isLive&&e("img",{onClick:()=>{P("Instagram",{action:"getLives"}).then(g=>{var W;let O=t.username;P("Instagram",{action:"viewLive",username:((W=g[O])==null?void 0:W.participant)??O}).then(j=>{var de,pe,Ie,Ee;if(!j)return q("error","Failed to view live, perhaps it ended?");let J=(de=g[O])!=null&&de.participant?g[(pe=g[O])==null?void 0:pe.participant]:g[O],fe=(J==null?void 0:J.participants)??[];fe.unshift({username:((Ie=g[O])==null?void 0:Ie.participant)??O,name:J.name,avatar:J.avatar,verified:J.verified,id:J.id}),ee.set({host:((Ee=g[O])==null?void 0:Ee.participant)??O,participants:fe,viewers:j}),l("live")})})},className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.png"}),t.hasStory&&!t.isLive?e("img",{className:"circle","data-seen":t.seenStory===1,src:"./assets/img/icons/instagram/StoryCircle.png",onClick:g=>{let[O,W]=Me(g);o.fetchAndSetStory({username:t.username,avatar:t.avatar,verified:t.verified},null,{x:O,y:W})}}):null]}),s("div",{className:"stats",children:[s("div",{children:[e("div",{className:"value",children:t.posts}),e("div",{className:"label",children:t.posts===1?i("APPS.INSTAGRAM.POST"):i("APPS.INSTAGRAM.POSTS")})]}),s("div",{onClick:()=>{k({display:!0,data:{title:i("APPS.INSTAGRAM.FOLLOWERS"),username:t.username,cb:()=>{N(t),l("profile"),k({display:!1})}}})},children:[e("div",{className:"value",children:t.followers}),e("div",{className:"label",children:t.followers===1?i("APPS.INSTAGRAM.FOLLOWER"):i("APPS.INSTAGRAM.FOLLOWERS")})]}),s("div",{onClick:()=>{k({display:!0,data:{title:i("APPS.INSTAGRAM.FOLLOWING"),username:t.username,cb:()=>{N(t),l("profile"),k({display:!1})}}})},children:[e("div",{className:"value",children:t.following}),e("div",{className:"label",children:i("APPS.INSTAGRAM.FOLLOWING")})]})]})]}),e("div",{className:"name",children:t.name}),e("div",{className:"description",children:ge(t.bio)??""}),e("div",{className:"buttons",children:c?c&&e("div",{className:"button edit",onClick:()=>{w(!0)},children:i("APPS.INSTAGRAM.EDIT_PROFILE")}):s(Y,{children:[t.isFollowing?e("div",{className:"button following",onClick:()=>{z.PopUp.set({title:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.username}),buttons:[{title:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{N({...t,isFollowing:!1})}}]})},children:i("APPS.INSTAGRAM.FOLLOWING")}):e("div",{className:"button follow",onClick:()=>{N({...t,isFollowing:!0})},children:i("APPS.INSTAGRAM.FOLLOW")}),e("div",{className:"button following",onClick:()=>{L({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),l("dm")},children:i("APPS.INSTAGRAM.MESSAGE")})]})})]}),e("div",{className:"posts",onScroll:Q,children:f&&f.map((g,O)=>{let W=O===f.length-1?"last":"",j=JSON.parse(g.media)[0];return e("div",{id:W,onClick:()=>{x({cb:()=>{N(t),l("profile"),b(null),x(null)}}),b(g),l("post")},children:ae(j)?e("video",{src:j,muted:!0,autoPlay:!0,loop:!0}):e("img",{src:j})},O)})})]})]})})}function it(){const{Func:n,View:h,GoBack:E,Post:o}=a.useContext(X),[S,d]=h,[m,u]=E,[v,A]=o,[l,t]=a.useState(""),[N,R]=a.useState(""),[_,p]=a.useState([]);a.useState([]);const[C,G]=a.useState([]),[b,F]=a.useState(0),[L,y]=a.useState(!1),[k,D]=a.useState(!1);a.useEffect(()=>{P("Instagram",{action:"getPosts",page:0}).then(c=>{c&&G(c)})},[]),a.useEffect(()=>{const c=setTimeout(()=>t(N),500);return()=>clearTimeout(c)},[N]),a.useEffect(()=>{l.length>0&&P("Instagram",{action:"search",query:l}).then(c=>{c&&p(c)})},[l]);const x=()=>{if(L||k||l.length>0)return;let c=document.querySelector("#last");if(!c)return;!ie(c)&&(D(!0),P("Instagram",{action:"getPosts",page:b+1}).then(I=>{I&&I.length>0?(G([...C,...I]),D(!1)):y(!0)}),F(I=>I+1))};return s("div",{className:"search-container",children:[e("div",{className:"search-header",children:e(Ae,{placeholder:i("SEARCH"),onChange:c=>R(c.target.value)})}),e("div",{className:"search-body",onScroll:x,children:l.length>0?e("div",{className:"search-results",children:_.map(c=>s("div",{className:"item",onClick:()=>{n.fetchAndSetProfile(c.username)},children:[e("div",{className:"profile-picture",children:e("img",{src:n.getAvatar(c.avatar),alt:"profile"})}),s("div",{className:"user",children:[s("div",{className:"username",children:[c.username,c.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:c.name})]})]}))}):e("div",{className:"feed-grid",children:C.map((c,r)=>{let w=Math.floor(r/3)%2==0,f=!1;f=r%3==(w?1:0),C[r+1]||(f=!1);let U=JSON.parse(c.media)[0],M=r==C.length-1?"last":"";return e("div",{id:M,className:`grid-post${f?" big":""}`,onClick:()=>{u({cb:()=>{d("search"),u(null)}}),A(c),d("post")},children:ae(U)?e("video",{src:U,autoPlay:!0,loop:!0,muted:!0}):e("img",{src:U,alt:"post"})},r)})})})]})}function rt(){const{View:n,GoBack:h,Comments:E,Account:o,Func:S}=a.useContext(X),[d]=o,[m,u]=n,[v]=h,[A,l]=E,[t,N]=a.useState(""),R=a.useRef(null),[_,p]=a.useState(0),[C,G]=a.useState(!1),[b,F]=a.useState(!1),L=()=>{t.length!==0&&P("Instagram",{action:"postComment",data:{postId:A.post.id,comment:t}}).then(k=>{if(!k)return q("error","Failed to post comment, no ");N(""),R.current.value="",l({...A,post:A.post,comments:[{user:{username:d.username,avatar:d.avatar,verified:d.verified},comment:{id:k,content:t,timestamp:new Date().getTime(),likes:0,liked:!1}},...A.comments]})})},y=()=>{if(C||b)return;let k=document.querySelector("#last");if(!k)return;!ie(k)&&(F(!0),P("Instagram",{action:"getComments",postId:A.post.id,page:_+1}).then(x=>{x&&x.length>0?(l({...A,comments:[...A.comments,...x]}),F(!1)):G(!0)}),p(x=>x+1))};return s("div",{className:"comments-container",children:[s("div",{className:"comments-header",children:[e(Ne,{onClick:()=>{v&&(v!=null&&v.cb)?v.cb():u("feed")}}),e("div",{className:"title",children:i("APPS.INSTAGRAM.COMMENTS")}),e("span",{})]}),s("div",{className:"comments-body",onScroll:y,children:[s("div",{className:"post-info",children:[e("div",{className:"profile-picture",children:e("img",{src:S.getAvatar(A.post.avatar),alt:"profile"})}),s("div",{className:"post-data",children:[s("div",{className:"caption",children:[s("span",{className:"username",children:[A.post.username,A.post.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),ge(A.post.caption)]}),e("div",{className:"actions",children:e("div",{className:"date",children:ye(A.post.timestamp)})})]})]}),A.comments.map((k,D)=>{let x=D===A.comments.length-1;return e(ct,{data:k,last:x},D)})]}),s("div",{className:"add-comment",children:[e("div",{className:"profile-picture",children:e("img",{src:S.getAvatar(d.avatar),alt:"profile"})}),s("div",{className:"input-container",children:[e(te,{type:"text",ref:R,placeholder:i("APPS.INSTAGRAM.ADD_COMMENT_AS").format({name:d.username}),onKeyPress:k=>{k.key==="Enter"&&L()},onChange:k=>N(k.target.value)}),e("div",{className:"send",onClick:L,children:i("APPS.INSTAGRAM.POST")})]})]})]})}const ct=({data:n,last:h})=>{const{Func:E}=a.useContext(X),[o,S]=a.useState(n.comment.liked),[d,m]=a.useState(n.comment.likes);return s("div",{className:"comment",id:h&&"last",children:[s("div",{className:"user",children:[e("div",{className:"profile-picture",onClick:()=>E.fetchAndSetProfile(n.user.username),children:e("img",{src:E.getAvatar(n.user.avatar),alt:"profile"})}),s("div",{className:"comment-data",children:[s("div",{className:"caption",children:[s("span",{className:"username",onClick:()=>E.fetchAndSetProfile(n.user.username),children:[n.user.username,n.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),n.comment.content]}),s("div",{className:"actions",children:[e("div",{className:"date",children:ye(n.comment.timestamp)}),s("div",{className:"likes",children:[d," ",i("APPS.INSTAGRAM.LIKES").toLowerCase()]})]})]})]}),e(Oe,{liked:o,onClick:()=>{n.comment.id&&P("Instagram",{action:"toggleLike",data:{postId:n.comment.id,toggle:!o,isComment:!0}}).then(u=>{u&&(S(u.liked),m(u.likes))})}})]})},ye=n=>{const h=new Date(n),o=new Date().getTime()-h.getTime(),S=Math.floor(o/(1e3*60*60*24)),d=Math.floor(o/(1e3*60*60)),m=Math.floor(o/(1e3*60));let u="";return S<1?d<1?u=`${m}m`:u=`${d}h`:S<30?u=`${S}d`:u=`${h.getDate()}/${h.getMonth()+1}/${h.getFullYear()}`,u};function lt(){var k,D,x;const{View:n}=a.useContext(X),[h,E]=n,[o,S]=a.useState(0),[d,m]=a.useState([]),[u,v]=a.useState(""),[A,l]=a.useState(null),[t,N]=a.useState([]),[R,_]=a.useState(""),[p,C]=a.useState(0),[G,b]=a.useState(!1),[F,L]=a.useState(!1);a.useEffect(()=>{P("Camera",{action:"getImages",page:0,filter:{showVideos:!0,showPhotos:!0}}).then(c=>{c&&N(c)})},[]);const y=c=>{if(F||G)return;let r=document.querySelector("#last");if(!r)return;!ie(r)&&(b(!0),P("Camera",{action:"getImages",page:p+1,filter:{showVideos:!0,showPhotos:!0}}).then(w=>{w&&w.length>0?(N([...t,...w]),b(!1)):L(!0)}),C(w=>w+1))};return a.useEffect(()=>{R&&R.includes("data:image")||De(R,c=>{if(c){const r=document.querySelector(".searchbox input");r&&(r.value=""),t.find(I=>I.src===R)||N(I=>[{src:R},...I])}})},[R]),s("div",{className:"newpost-container","data-camera":!1,children:[o===0&&s(Y,{children:[s("div",{className:"newpost-header",children:[e(re,{onClick:()=>E("feed")}),e("div",{className:"title",children:i("APPS.INSTAGRAM.NEW_POST")}),e("div",{className:"next",onClick:()=>{d.length>0&&o==0&&S(1)},children:i("APPS.INSTAGRAM.NEXT")})]}),((x=(D=(k=ve)==null?void 0:k.value)==null?void 0:D.AllowExternal)==null?void 0:x.Instagram)&&e(Ae,{placeholder:i("COMPONENTS.GALLERY.EXTERNAL_URL"),onChange:c=>_(c.target.value)}),e("div",{className:"newpost-body",onScroll:y,children:e("div",{className:"images",children:t.map((c,r)=>{let I=r===t.length-1?"last":"";return s("div",{id:I,className:"image",onClick:()=>{d.includes(c.src)?m(d.filter(f=>f!==c.src)):d.length<5&&m([...d,c.src])},children:[ae(c.src)?e(ot,{src:c.src}):e("img",{src:c.src,alt:"image"}),e("div",{className:"select",children:e(qe,{checked:d.includes(c.src)})})]},r)})})})]}),o===1&&s(Y,{children:[s("div",{className:"newpost-header",children:[e(Ne,{onClick:()=>S(0)}),e("div",{className:"title",children:i("APPS.INSTAGRAM.NEW_POST")}),e("div",{className:"next",onClick:()=>{P("Instagram",{action:"newPost",data:{caption:u,location:A,images:d}}).then(c=>{c&&E("feed")})},children:i("APPS.INSTAGRAM.POST")})]}),e("div",{className:"newpost-body",children:s("div",{className:"newpost-content",children:[s("div",{className:"caption",children:[e("div",{className:"image",children:ae(d[0])?e("video",{src:d[0],muted:!0}):e("img",{src:d[0],alt:"image"})}),e("div",{className:"text-area",children:e(ke,{onChange:c=>v(c.target.value),placeholder:i("APPS.INSTAGRAM.CAPTION_PLACEHOLDER")})})]}),e("div",{className:"item",onClick:()=>{z.PopUp.set({title:"Choose Location",description:"Choose a location for your post",input:{type:"text",maxCharacters:30,onChange:c=>l(c)},buttons:[{title:"Cancel"},{title:"Proceed"}]})},children:A?s(Y,{children:[s("div",{className:"label",children:[e(xe,{}),A]}),e(re,{onClick:c=>{c.stopPropagation(),l(null)}})]}):s(Y,{children:[e("div",{className:"label",children:"Location"}),e(We,{})]})})]})})]})]})}const ot=({src:n})=>{const[h,E]=a.useState(null);return s(Y,{children:[e("video",{src:n,crossOrigin:"anonymous",controls:!1,onMouseOver:S=>S.currentTarget.play(),onMouseOut:S=>S.currentTarget.pause(),onLoadedMetadata:S=>E(S.currentTarget.duration)}),h&&e("div",{className:"video-duration",children:(S=>{const d=Math.floor(S/60),m=ze(S-d*60,0);return`${d}:${m<10?"0"+m:m}`})(h)})]})};function dt(){const{View:n,Post:h,GoBack:E}=a.useContext(X),[o,S]=n,[d]=E,[m]=h;return e(Y,{children:m&&e("div",{className:"viewpost-container",children:s(Y,{children:[s("div",{className:"viewpost-header",children:[e(Ne,{onClick:()=>{d&&(d.cb?d.cb():S(d.view))}}),e("div",{className:"name",children:m.username??"Unknown"}),e("span",{})]}),e("div",{className:"profile-body",children:e(Ge,{data:m})})]})})})}function mt(){const{Func:n,Account:h,Dm:E,View:o,GoBack:S}=a.useContext(X);se(ce.Settings);const[d]=h,[m,u]=o,[v,A]=E,[l,t]=S,[N,R]=a.useState([]),_=a.useRef(null),p=a.useRef(0),[C,G]=a.useState({content:"",attachments:[]}),[b,F]=a.useState(0),[L,y]=a.useState(!1),[k,D]=a.useState(!1);a.useEffect(()=>{y(!1),D(!1),F(0),R([]),P("Instagram",{action:"getMessages",page:0,username:v.username}).then(r=>{r&&R(r.reverse())})},[]),Z("instagram:newMessage",r=>{if(v.username!==r.sender)return;R([...N,r]);let I=document.querySelector(".dm-body-container");I.scrollTop=I.scrollHeight});const x=()=>{C.content.length===0&&C.attachments.length===0||P("Instagram",{action:"sendMessage",username:v.username,message:{content:C.content,attachments:C.attachments.length>0?C.attachments:null}}).then(r=>{if(!r)return;_.current.value="",R([...N,{sender:d.username,recipient:v.username,content:C.content,attachments:C.attachments,timestamp:Date.now()}]),G({content:"",attachments:[]});let I=document.querySelector(".dm-body-container");I.scrollTop=I.scrollHeight})},c=()=>{if(L||k)return;let r=document.querySelector("#last");if(!r)return;!ie(r)&&(D(!0),P("Instagram",{action:"getMessages",page:b+1,username:v.username}).then(w=>{if(w&&w.length>0){let f=document.querySelector(".dm-body-container");p.current=f.scrollHeight,R([...w.reverse(),...N]),D(!1)}else y(!0)}),F(w=>w+1))};return a.useEffect(()=>{let r=document.querySelector(".dm-body-container");const I=r.scrollHeight;r.scrollTop+=I-p.current,r.scroll},[N]),s("div",{className:"dm-container",children:[s("div",{className:"dm-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{l&&l.cb?(l.cb(),t(null)):u("dmList")}}),s("div",{className:"profile",onClick:r=>{r.stopPropagation(),t({cb:()=>{A(v),u("dm")}}),n.fetchAndSetProfile(v.username)},children:[e("div",{className:"avatar",children:e("img",{src:n.getAvatar(v.avatar)})}),s("div",{className:"username",children:[v.name??v.username,v.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]})]})]}),e("div",{className:"dm-body-container",onScroll:c,children:e("div",{className:"dm-body",children:N.map((r,I)=>{var $;let w,f=I===0,U=r.sender===d.username?"self":"other",M=(($=N[I+1])==null?void 0:$.sender)===d.username?"self":"other";return N[I+1]?w=Math.abs(r.timestamp-N[I+1].timestamp)/36e5:M=void 0,s("div",{className:`message ${U}`,id:f?"last":"",children:[U=="other"?s("div",{className:"message-with-pfp",children:[e("div",{className:`profile-picture ${U!==M?"show":"hide"}`,onClick:B=>{B.stopPropagation(),t({cb:()=>{A(v),u("dm")}}),n.fetchAndSetProfile(v.username)},children:e("img",{src:n.getAvatar(v.avatar)})}),s("div",{className:"message-content",children:[r.content&&e("div",{className:"content",children:ge(r.content)}),r.attachments&&e("div",{className:"attatchments",children:r.attachments.map((B,K)=>ae(B)?e("video",{src:B,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:V=>{z.FullscreenImage.set({display:!0,image:B})}},K):e(Te,{src:B,onClick:()=>{z.FullscreenImage.set({display:!0,image:B})}},K))})]})]}):s(Y,{children:[r.content&&e("div",{className:"content",children:ge(r.content)}),r.attachments&&e("div",{className:"attatchments",children:r.attachments.map((B,K)=>ae(B)?e("video",{src:B,controls:!1,loop:!0,muted:!0,autoPlay:!0,onClick:V=>{z.FullscreenImage.set({display:!0,image:B})}},K):e("img",{src:B,onClick:()=>{z.FullscreenImage.set({display:!0,image:B})}},K))})]}),N[I+1]&&w>6?e("div",{className:"date",children:we(r.timestamp)}):U!==M&&e("div",{className:"date",children:we(r.timestamp)})]},I)})})}),e("div",{className:"attachments",children:C.attachments.map((r,I)=>s("div",{className:"attachment",children:[ae(r)?e("video",{src:r,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e(Te,{src:r}),e(re,{onClick:()=>{G({...C,attachments:C.attachments.filter((w,f)=>f!==I)})}})]},I))}),s("div",{className:"dm-footer",children:[e(te,{type:"text",ref:_,onChange:r=>{G({...C,content:r.target.value})},onKeyDown:r=>{r.key==="Enter"&&x()},placeholder:i("APPS.INSTAGRAM.MESSAGE_PLACEHOLDER")}),C.content.length>0?e("span",{onClick:()=>x(),className:"send",children:i("APPS.INSTAGRAM.SEND")}):e(Be,{onClick:()=>{var r,I,w;C.attachments.length<3&&z.Gallery.set({includeVideos:!0,allowExternal:(w=(I=(r=ve)==null?void 0:r.value)==null?void 0:I.AllowExternal)==null?void 0:w.Instagram,onSelect:f=>G({...C,attachments:[...C.attachments,f.src]})})}})]})]})}function ut(){const{View:n,Func:h,Dm:E,Account:o,GoBack:S}=a.useContext(X),[d,m]=n,[u]=o,[v,A]=E,[l,t]=S,[N,R]=a.useState(!1),[_,p]=a.useState(""),[C,G]=a.useState(""),[b,F]=a.useState([]);a.useState([]);const[L,y]=a.useState([]),[k,D]=a.useState(0),[x,c]=a.useState(!1),[r,I]=a.useState(!1);a.useEffect(()=>{P("Instagram",{action:"getRecentMessages",page:0}).then(f=>{f&&y(f)})},[]);const w=()=>{if(x||r)return;let f=document.querySelector("#last");if(!f)return;!ie(f)&&(I(!0),P("Instagram",{action:"getRecentMessages",page:k+1}).then(M=>{M&&M.length>0?(y([...L,...M]),I(!1)):c(!0)}),D(M=>M+1))};return a.useEffect(()=>{const f=setTimeout(()=>p(C),500);return()=>clearTimeout(f)},[C]),a.useEffect(()=>{_.length>0?N?P("Instagram",{action:"search",query:_}).then(f=>{f&&F(f)}):F(L.filter(f=>{var U;return f.username.includes(_)||((U=f==null?void 0:f.name)==null?void 0:U.includes(_))&&f.username!==u.username})):F([])},[_]),a.useEffect(()=>{p(""),F([])},[N]),e("div",{className:"dm-list",children:N?s("div",{className:"slide up",children:[s("div",{className:"dm-list-header new",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{R(!1),F([])}}),e("div",{className:"title",children:i("APPS.INSTAGRAM.NEW_MESSAGE")}),e("span",{})]}),s("div",{className:"dm-list-body ",children:[s("div",{className:"input",children:[e("span",{children:i("APPS.INSTAGRAM.TO")}),e(te,{type:"text",onChange:f=>G(f.target.value),placeholder:i("SEARCH")})]}),b.length>0&&e("div",{className:"items",children:b.map((f,U)=>s("div",{className:"item",onClick:()=>{R(!1),A(f),m("dm")},children:[e("div",{className:"avatar",onClick:M=>{M.stopPropagation(),t({cb:()=>{m("dmList"),t(null)}}),h.fetchAndSetProfile(f.username)},children:e("img",{src:h.getAvatar(f.avatar)})}),s("div",{className:"info",children:[s("div",{className:"username",children:[f.username,f.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"last-message",children:f.name})]})]},U))})]})]}):s(Y,{children:[s("div",{className:"dm-list-header",children:[s("div",{className:"top",children:[e("i",{className:"far fa-chevron-left",onClick:()=>m("feed")}),e("i",{className:"far fa-edit",onClick:()=>R(!0)})]}),e(Ae,{placeholder:i("SEARCH"),onChange:f=>G(f.target.value)})]}),e("div",{className:"dm-list-body",onScroll:w,children:e("div",{className:"items",children:_.length>0&&!N?b.map((f,U)=>{var M;return((M=f.content)==null?void 0:M.length)===0&&(f.content=i("APPS.INSTAGRAM.SENT_A_PHOTO")),s("div",{className:"item",onClick:()=>{R(!1),A(f),m("dm")},children:[e("div",{className:"avatar",onClick:$=>{$.stopPropagation(),t({cb:()=>{m("dmList"),t(null)}}),h.fetchAndSetProfile(f.username)},children:e("img",{src:h.getAvatar(f.avatar)})}),s("div",{className:"info",children:[s("div",{className:"username",children:[f.name,f.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),s("div",{className:"last-message",children:[f.content.length>40?f.content.substring(0,40)+"...":f.content,"  ",oe(f.timestamp)]})]})]},U)}):L.map((f,U)=>{let M=U===L.length-1;return f.content.length===0&&(f.content=i("APPS.INSTAGRAM.SENT_A_PHOTO")),s("div",{className:"item",id:M?"last":"",onClick:()=>{R(!1),A(f),m("dm")},children:[e("div",{className:"avatar",onClick:$=>{$.stopPropagation(),t({cb:()=>{m("dmList"),t(null)}}),h.fetchAndSetProfile(f.username)},children:e("img",{src:h.getAvatar(f.avatar)})}),s("div",{className:"info",children:[s("div",{className:"username",children:[f.name,f.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),f.content.length>40?f.content.substring(0,40)+"...":f.content,"  ",oe(f.timestamp)]})]},U)})})})]})})}function ft(){var I,w,f,U;const{Account:n,View:h,Func:E,Stories:o,Story:S,Dm:d}=a.useContext(X),[m]=n,[u,v]=h,[A,l]=o,[t,N]=S,[R,_]=d,[p,C]=a.useState(0),[G,b]=a.useState(""),[F,L]=a.useState(!1),[y,k]=a.useState({x:0,y:0});a.useEffect(()=>{if(t){k(t.origin);for(let M=0;M<t.media.length;M++)if(!t.media[M].seen)return C(M)}},[]);const D=M=>{if(F)return L(!1);const $=M.target.getBoundingClientRect(),B=M.clientX-$.left*he();let K=t.media[p];if(K.seen||P("Instagram",{action:"viewedStory",id:K.id}),B<$.width*he()/2)if(p>0)C(p-1);else{let V=A.findIndex(Q=>Q.username===t.username),H=A[V-1];H&&E.fetchAndSetStory(H)}else if(p<t.media.length-1)C(p+1);else{let V=A.findIndex(Q=>Q.username===t.username),H=A[V+1];H?(c(t.username),E.fetchAndSetStory(H),C(0)):r()}},x=()=>{!G||G===""||P("Instagram",{action:"sendMessage",username:t.username,message:{content:G}}).then(M=>{M&&(_({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),v("dm"),r())})},c=M=>{t.media.length===p+1&&l($=>$.map(B=>(B.username===M&&(B.seen=!0),B)))},r=M=>{M!==!1&&c(t.username),N(null)};return s(Se.div,{className:"instagram-story",initial:{scale:0,transformOrigin:t!=null&&t.origin?`${((I=t==null?void 0:t.origin)==null?void 0:I.x)??0}px ${((w=t==null?void 0:t.origin)==null?void 0:w.y)??0}px`:"50% 50%"},animate:{scale:1,transformOrigin:t!=null&&t.origin?`${((f=t==null?void 0:t.origin)==null?void 0:f.x)??0}px ${((U=t==null?void 0:t.origin)==null?void 0:U.y)??0}px`:"50% 50%"},exit:{scale:0,transformOrigin:y?`${(y==null?void 0:y.x)??0}px ${(y==null?void 0:y.y)??0}px`:"50% 50%"},transition:{duration:.25,ease:"easeInOut"},children:[ae(t==null?void 0:t.media[p].image)?e("video",{className:"background-image",onClick:D,autoPlay:!0,loop:!0,src:t==null?void 0:t.media[p].image}):e("div",{className:"background-image",onClick:D,style:{backgroundImage:`url(${t==null?void 0:t.media[p].image})`}}),e(Pe,{children:F&&e(ht,{activeImage:p,close:()=>L(!1)})}),s("div",{className:"story-wrapper",children:[s("div",{className:"story-header",children:[e("div",{className:"story-steps",children:t==null?void 0:t.media.map((M,$)=>e("div",{className:p===$?"active":"",onClick:()=>C($)},$))}),s("div",{className:"profile-details",children:[s("div",{className:"profile",onClick:()=>E.fetchAndSetProfile(t.username),children:[e("div",{className:"profile-picture",style:{backgroundImage:`url(${E.getAvatar(t==null?void 0:t.avatar)})`}}),s("div",{className:"name",children:[t==null?void 0:t.username,!1]}),e("div",{className:"time",children:oe(t==null?void 0:t.media[p].timestamp)})]}),e("div",{className:"stats",children:e(re,{onClick:()=>{if(t!=null&&t.media[p].seen)return r();P("Instagram",{action:"viewedStory",id:t==null?void 0:t.media[p].id}).then(M=>r())}})})]})]}),(t==null?void 0:t.username)===m.username?s("div",{className:"story-footer","data-stats":!0,children:[s("div",{className:"seen-by",onClick:()=>L(!0),children:[(t==null?void 0:t.media[p].viewers)&&e("div",{className:"images",children:t==null?void 0:t.media[p].viewers.map((M,$)=>e("img",{src:E.getAvatar(M.avatar)},$))}),i("APPS.INSTAGRAM.SEEN_BY").format({count:Xe(t==null?void 0:t.media[p].views)??0})]}),e(re,{onClick:()=>{z.PopUp.set({title:i("APPS.INSTAGRAM.DELETE_STORY.TITLE"),description:i("APPS.INSTAGRAM.DELETE_STORY.DESCRIPTION"),buttons:[{title:i("APPS.INSTAGRAM.DELETE_STORY.CANCEL")},{title:i("APPS.INSTAGRAM.DELETE_STORY.PROCEED"),color:"red",cb:()=>{P("Instagram",{action:"removeFromStory",id:t==null?void 0:t.media[p].id}).then(M=>{if(!M)return q("error","Failed to remove image from story");q("info","Removed image from story"),N(null),t.media.length===1&&l($=>$.filter(B=>B.username!==t.username))})}}]})}})]}):s("div",{className:"story-footer",children:[e("div",{className:"input",children:e(te,{type:"text",placeholder:i("APPS.INSTAGRAM.SEND_A_MESSAGE"),onChange:M=>b(M.target.value),onKeyDown:M=>{M.key==="Enter"&&x()}})}),e(He,{onClick:()=>x()})]})]})]})}const ht=n=>{var _;const{Func:h,Story:E}=a.useContext(X),[o,S]=E,[d,m]=a.useState([]),[u,v]=a.useState(0),[A,l]=a.useState(!1),[t,N]=a.useState(!1);a.useEffect(()=>{(n==null?void 0:n.activeImage)!==void 0&&P("Instagram",{action:"getViewers",id:o==null?void 0:o.media[n.activeImage].id,page:0}).then(p=>{p&&(m(p),p.length<15&&l(!0))})},[]);const R=p=>{if(A||t)return;let C=document.querySelector("#last");if(!C)return;!ie(C)&&(N(!0),P("Instagram",{action:"getViewers",id:o==null?void 0:o.media[n.activeImage].id,page:u+1}).then(b=>{b&&b.length>0?(m(F=>[...F,...b]),N(!1),b.length<15&&l(!0)):l(!0)}),v(b=>b+1))};return s(Se.div,{className:"story-modal",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[s("div",{className:"story-modal-header",children:[s("div",{className:"views",children:[e($e,{})," ",e("div",{className:"views",children:((_=o==null?void 0:o.media[n==null?void 0:n.activeImage])==null?void 0:_.views)??0})]}),e(re,{className:"close",onClick:n==null?void 0:n.close})]}),s("div",{className:"story-modal-content",children:[e("div",{className:"title",children:i("APPS.INSTAGRAM.STORY_VIEWERS")}),e("div",{className:"viewers",onScroll:R,children:d.map((p,C)=>{let G=C===d.length-1?"last":"";return e("div",{className:"item",id:G,children:s("div",{className:"user",onClick:()=>{h.fetchAndSetProfile(p.username),S(null)},children:[e("div",{className:"profile-picture",children:e("img",{src:h.getAvatar(p.avatar)})}),s("div",{className:"user-details",children:[s("div",{className:"username",children:[p.username,p.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:p.name})]})]})},C)})})]})]})};function gt(){var u;const{Func:n,View:h,Account:E}=a.useContext(X),o=se(ce.Settings),[S,d]=h,[m]=E;return e("div",{className:"instagram-footer",children:s(Y,{children:[e("svg",{color:"#262626",fill:"#262626",height:"24",viewBox:"0 0 24 24",width:"24",onClick:()=>d("feed"),children:e("g",{children:S=="feed"?e("path",{fill:o.display.theme=="dark"&&"#fafafa",d:"M22 23h-6.001a1 1 0 01-1-1v-5.455a2.997 2.997 0 10-5.993 0V22a1 1 0 01-1 1H2a1 1 0 01-1-1V11.543a1.002 1.002 0 01.31-.724l10-9.543a1.001 1.001 0 011.38 0l10 9.543a1.002 1.002 0 01.31.724V22a1 1 0 01-1 1z"}):e("path",{d:"M9.005 16.545a2.997 2.997 0 012.997-2.997h0A2.997 2.997 0 0115 16.545V22h7V11.543L12 2 2 11.543V22h7.005z",fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"2"})})}),e("svg",{color:"#262626",fill:"#262626",height:"24",viewBox:"0 0 24 24",width:"24",onClick:()=>d("search"),children:S=="search"?e("path",{fill:o.display.theme=="dark"&&"#fafafa",d:"M13.173 13.164l1.491-3.829-3.83 1.49zM12.001.5a11.5 11.5 0 1011.5 11.5A11.513 11.513 0 0012.001.5zm5.35 7.443l-2.478 6.369a1 1 0 01-.57.569l-6.36 2.47a1 1 0 01-1.294-1.294l2.48-6.369a1 1 0 01.57-.569l6.359-2.47a1 1 0 011.294 1.294z"}):s(Y,{children:[e("polygon",{fill:"none",points:"13.941 13.953 7.581 16.424 10.06 10.056 16.42 7.585 13.941 13.953",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"}),e("polygon",{fillRule:"evenodd",points:"10.06 10.056 13.949 13.945 7.581 16.424 10.06 10.056"}),e("circle",{cx:"12.001",cy:"12.005",fill:"none",r:"10.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"})]})}),e("svg",{color:"#262626",fill:"#262626",height:"24",viewBox:"0 0 24 24",width:"24",onClick:()=>d("newPost"),children:s(Y,{children:[e("path",{d:"M2 12v3.45c0 2.849.698 4.005 1.606 4.944.94.909 2.098 1.608 4.946 1.608h6.896c2.848 0 4.006-.7 4.946-1.608C21.302 19.455 22 18.3 22 15.45V8.552c0-2.849-.698-4.006-1.606-4.945C19.454 2.7 18.296 2 15.448 2H8.552c-2.848 0-4.006.699-4.946 1.607C2.698 4.547 2 5.703 2 8.552z",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2"}),e("line",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",x1:"6.545",x2:"17.455",y1:"12.001",y2:"12.001"}),e("line",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",x1:"12.003",x2:"12.003",y1:"6.545",y2:"17.455"})]})}),S==="notifications"?e("svg",{fill:"#262626",height:"24",viewBox:"0 0 48 48",width:"24",children:e("path",{fill:o.display.theme=="dark"&&"#fafafa",d:"M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"})}):e("svg",{color:((u=o==null?void 0:o.display)==null?void 0:u.theme)==="dark"?"#ffffff":"#262626",fill:o.display.theme==="dark"?"#ffffff":"#262626",height:"24",viewBox:"0 0 24 24",width:"24",onClick:()=>d("notifications"),children:e("path",{color:o.display.theme=="dark"&&"#fafafa",d:"M16.792 3.904A4.989 4.989 0 0121.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 014.708-5.218 4.21 4.21 0 013.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 013.679-1.938m0-2a6.04 6.04 0 00-4.797 2.127 6.052 6.052 0 00-4.787-2.127A6.985 6.985 0 00.5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 003.518 3.018 2 2 0 002.174 0 45.263 45.263 0 003.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 00-6.708-7.218z"})}),e("img",{src:n.getAvatar(m.avatar),className:"profile",alt:"profile",onClick:()=>n.fetchAndSetProfile(m.username)})]})})}function vt(){const{Account:n,UserPanel:h,GoBack:E}=a.useContext(X),[o,S]=h,[d,m]=a.useState([]),[u,v]=a.useState(0),[A,l]=a.useState(!1),[t,N]=a.useState(!1);let R={[i("APPS.INSTAGRAM.FOLLOWING")]:"getFollowing",[i("APPS.INSTAGRAM.FOLLOWERS")]:"getFollowers",[i("APPS.TWITTER.LIKED_BY")]:"getLikes"};a.useEffect(()=>{P("Instagram",{action:R[o.data.title],data:{postId:o.data.postId,username:o.data.username,page:0}}).then(p=>{p&&m(p)})},[]);const _=()=>{if(A||t)return;!ie(document.querySelector("#last"))&&(N(!0),P("Instagram",{action:R[o.data.title],data:{postId:o.data.postId,username:o.data.username,page:u+1}}).then(C=>{C&&C.length>0?(m([...d,...C]),N(!1)):l(!0)}),v(C=>C+1))};return e(Y,{children:o.data&&d&&s("div",{className:"userpanel-container",children:[s("div",{className:"userpanel-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{var p;(p=o.data)==null||p.cb()}}),e("div",{className:"userpanel-title",children:o.data.title}),e("span",{})]}),e("div",{className:"userpanel-body",onScroll:_,children:e("div",{className:"items",children:d.map((p,C)=>{let G=C===d.length-1;return e(Pt,{data:p,allData:o.data,last:G},C)})})})]})})}const Pt=n=>{const{Func:h,Account:E,GoBack:o,UserPanel:S}=a.useContext(X),[d]=E,[m,u]=o,[v,A]=S;let l=n.data,t=n.last;const[N,R]=a.useState(l.isFollowing===1);return s("div",{className:"item",id:t?"last":"",onClick:()=>{u({cb:()=>{A({display:!0,data:n.allData})}}),h.fetchAndSetProfile(l.username)},children:[s("div",{className:"user",children:[e("div",{className:"profile-picture",children:e("img",{src:h.getAvatar(l.avatar),alt:"profile"})}),s("div",{className:"user-details",children:[s("div",{className:"username",children:[l.username,l.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:l.name})]})]}),d.username!==l.username&&e("div",{className:"action",onClick:_=>{_.stopPropagation(),l.username!==d.username&&(N?z.PopUp.set({title:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:l.username}),buttons:[{title:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{P("Instagram",{action:"toggleFollow",data:{username:l.username,following:!N}}).then(()=>{R(p=>!p)})}}]}):P("Instagram",{action:"toggleFollow",data:{username:l.username,following:!N}}).then(()=>{R(p=>!p)}))},children:N?e("div",{className:"button following",children:i("APPS.INSTAGRAM.FOLLOWING")}):e("div",{className:"button follow",children:i("APPS.INSTAGRAM.FOLLOW")})})]})},X=a.createContext(null);function Tt(){const{Func:n}=a.useContext(je),h=se(ce.Settings),E=se(ce.App),[o,S]=n.TextColor,[d,m]=a.useState("feed"),[u,v]=a.useState(null),[A,l]=a.useState(!1),[t,N]=a.useState([]),[R,_]=a.useState(null),[p,C]=a.useState(null),[G,b]=a.useState(null),[F,L]=a.useState(null),[y,k]=a.useState(null),[D,x]=a.useState(null),[c,r]=a.useState({display:!1,data:null}),[I,w]=a.useState(!0);a.useEffect(()=>{var V;E&&(E==null?void 0:E.view)==="profile"&&U((V=E==null?void 0:E.data)==null?void 0:V.username)},[E]),a.useEffect(()=>{P("isAdmin").then(V=>{if(ne.APPS.INSTAGRAM.account.value){v({...ne.APPS.INSTAGRAM.account.value,isAdmin:V}),l(!0),w(!1);return}else if(ne.APPS.INSTAGRAM.account.value===!1)return w(!1);P("Instagram",{action:"isLoggedIn"}).then(H=>{H?(ne.APPS.INSTAGRAM.account.set(H),v({...H,isAdmin:V}),l(!0),w(!1)):(w(!1),ne.APPS.INSTAGRAM.account.set(null))})})},[]),a.useEffect(()=>(setTimeout(()=>{d==="live"||d==="newPost"||d==="story"?(S("#fafafaed"),d=="live"&&z.IndicatorVisible.set(!1)):(S(h.display.theme==="dark"?"#fafafaed":"#000000"),z.IndicatorVisible.set(!0)),d==="dm"?me.ReceiveAppNotifications.set(!1):me.ReceiveAppNotifications.set(!0)},250),()=>{me.ReceiveAppNotifications.set(!0)}),[d]);const f=(V,H)=>{V&&P("Instagram",{action:"getPost",id:V}).then(Q=>{if(Q){if(H)return M(Q);k(Q),m("post")}})},U=V=>{V&&P("Instagram",{action:"getProfile",username:V}).then(H=>{H&&(C(H),m("profile"))})},M=V=>{V.id&&P("Instagram",{action:"getComments",postId:V.id,page:0}).then(H=>{H&&(L({post:V,comments:H}),m("comments"))})},$=(V,H,Q)=>{!V&&!(V!=null&&V.username)||((H==null?void 0:H.length)==0&&(H=void 0),P("Instagram",{action:"getStory",username:V.username}).then(le=>{le&&_({username:V.username,avatar:V.avatar,verified:V.verified,media:le,queue:H,origin:Q})}))},B=V=>V||"./assets/img/icons/instagram/unknown-pfp.jpg",K={feed:e(tt,{}),search:e(it,{}),notifications:e(at,{}),profile:e(nt,{}),live:e(Ke,{}),logIn:e(Le,{}),comments:e(rt,{}),post:e(dt,{}),newPost:e(lt,{}),userpanel:e(vt,{}),dmList:e(ut,{}),dm:e(mt,{})};return a.useEffect(()=>{c.display&&m("userpanel")},[c]),e("div",{className:"instagram-container",children:e(X.Provider,{value:{View:[d,m],Account:[u,v],Profile:[p,C],Post:[y,k],Comments:[F,L],LoggedIn:[A,l],GoBack:[D,x],UserPanel:[c,r],Dm:[G,b],Stories:[t,N],Story:[R,_],Func:{fetchAndSetProfile:U,fetchAndSetStory:$,fetchAndSetComments:M,fetchAndSetPost:f,getAvatar:B}},children:I||h.airplaneMode?e("div",{className:"loading",children:e(Ye,{size:40,lineWeight:5,speed:2,color:o})}):e("div",{className:"instagram-wrapper",children:A?s(Y,{children:[e(Pe,{children:R&&e(ft,{})}),K[d],d!=="live"&&d!=="logIn"&&d!=="newPost"&&d!=="comments"&&!R&&e(gt,{})]}):e(Le,{})})})})}export{X as InstagramContext,Tt as default};
