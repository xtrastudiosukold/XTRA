import{r as E,a as f,F as j,j as e}from"./jsx-runtime-f40812bf.js";import{s as $,u as U,as as ae,A as z,m as G,az as le,I as ne,an as ce,ai as de,o as ue,aA as Pe,aB as me,aC as ve,a as se,T as Ae,ay as te,ae as ie,aD as re,aE as fe,aF as he,aG as Se,aH as Oe}from"./index.esm-497ba86e.js";import{o as S,f as I,d as h,y as Ee,L as t,z as q,C as H,h as J,O as ge,Q as pe,g as K,v as Z,D as Ce,b as Te,R as Q}from"./Phone-a6f774c9.js";import{r as be,f as Ie}from"./number-28525126.js";const X=({src:o,showAdvanced:s})=>{const[n,m]=E.useState(null);return f(j,{children:[e("video",{src:o,crossOrigin:"anonymous",controls:!1,onMouseOver:T=>{s&&T.currentTarget.play()},onMouseOut:T=>{s&&T.currentTarget.pause()},muted:!0,loop:!0,onLoadedMetadata:T=>{m(T.currentTarget.duration)}}),n&&s&&e("div",{className:"video-duration",children:(T=>{const M=Math.floor(T/60),y=be(T-M*60,0);return`${M}:${y<10?"0"+y:y}`})(n)})]})},_=$(null),Y=[{title:t("APPS.PHOTOS.VIDEOS"),id:"videos",icon:e(de,{}),count:0},{title:t("APPS.PHOTOS.SELFIES"),id:"selfies",icon:e(ue,{}),count:0},{title:t("APPS.PHOTOS.SCREENSHOTS"),id:"screenshots",icon:e(Pe,{}),count:0},{title:t("APPS.PHOTOS.IMPORTS"),id:"imports",icon:e(me,{}),count:0},{title:t("APPS.PHOTOS.DUPLICATES"),id:"duplicates",icon:e(ve,{}),count:0}];function Me(){const o=U(_),[s,n]=E.useState(!1),m=E.useRef(null),[p,T]=E.useState([]),[M,y]=E.useState(Y);E.useEffect(()=>{S.APPS.CAMERA.albums.value&&S.APPS.CAMERA.mediaTypes.value?(T(S.APPS.CAMERA.albums.value),y(S.APPS.CAMERA.mediaTypes.value)):I("Camera",{action:"getAlbums"}).then(u=>{if(!u)return h("error","No data received from server");let b=M.map(C=>{const R=u.mediaTypes.find(O=>O.id===C.id);return R?{...C,count:R.count}:C});T(u.albums),y(b),S.APPS.CAMERA.albums.set(u.albums),S.APPS.CAMERA.mediaTypes.set(b)})},[o]),E.useEffect(()=>m!=null&&m.current?(m.current.addEventListener("wheel",u=>{u.preventDefault(),m.current.scrollLeft+=u.deltaY}),()=>{m!=null&&m.current&&(m==null||m.current.removeEventListener("wheel",u=>{u.preventDefault(),m.current.scrollLeft+=u.deltaY}))}):h("warning","Scroll container not found"),[m==null?void 0:m.current]);const L=()=>{let u="";H.PopUp.set({title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.NEW_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.NEW_ALBUM_POPUP.PLACEHOLDER"),maxCharacters:20,onChange:b=>{u=b}},buttons:[{title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.PROCEED"),cb:()=>{I("Camera",{action:"createAlbum",title:u}).then(b=>{if(!b)return h("warning","Could not create album, id not returned");if(u.length<1)return h("warning","Input is empty, cannot create album");if(u.length>20)return h("warning","Input is too long, cannot create album");let C={title:u,id:b,cover:null,count:0};T([...p,C]),S.APPS.CAMERA.albums.value=[...p,C]})}}]})},B=u=>{if(!u)return h("warning","No album id provided, cannot remove album");H.PopUp.set({title:t("APPS.PHOTOS.REMOVE_ALBUM.TITLE").format({name:u.title}),description:t("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION").format({name:u.title}),buttons:[{title:t("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:t("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{I("Camera",{action:"deleteAlbum",id:u.id}).then(b=>{if(!b)return h("error","Could not remove album, server returned false");S.APPS.CAMERA.albums.set(p.filter(C=>C.id!==u.id)),T(p.filter(C=>C.id!==u.id))})}}]})},P=Ee(u=>{let b=u.target;for(;!b.classList.contains("album");)b=b.parentElement;let C=parseInt(b.getAttribute("data-id"));if(!C)return h("warning","Could not obtain album id from element");H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let R="";H.PopUp.set({title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:O=>{R=O}},buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(R.length<1)return h("warning","Input is empty, cannot rename album");h("warning","Renaming album",C,R),I("Camera",{action:"renameAlbum",id:C,title:R}).then(O=>{if(!O)return h("error","Could not rename album, server returned false");T(p.map(c=>c.id===C?{...c,title:R}:c)),S.APPS.CAMERA.albums.set(p.map(c=>c.id===C?{...c,title:R}:c))})}}]})}},{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>B(p.find(R=>R.id===C))}]})});return e(j,{children:o?e(z,{children:e(Ne,{})}):f(j,{children:[f("div",{className:"albums-header",children:[f("div",{className:"top",children:[e(ae,{onClick:L}),e("div",{className:"edit",onClick:()=>n(!s),children:s?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.EDIT")})]}),e("div",{className:"title",children:t("APPS.PHOTOS.ALBUMS")})]}),f("div",{className:"albums-content",children:[e("div",{className:"subtitle",children:t("APPS.PHOTOS.MY_ALBUMS")}),e("div",{className:"albums-grid","data-edit":s,ref:m,children:e(z,{children:p.map((u,b)=>f(G.div,{animate:{scale:1},exit:{scale:.2},transition:{duration:.25,ease:"easeInOut"},className:"album","data-id":u.id,"data-removable":u.removable,...P,onClick:()=>{s||_.set(u)},children:[s&&u.removable!==!1&&e("div",{className:"remove",onClick:C=>{C.stopPropagation(),B(u)},children:e(le,{})}),f("div",{className:"cover",children:[q(u.cover)?e(X,{src:u.cover,showAdvanced:!1}):e("img",{src:u.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"}),u.id==="favourites"&&e(ne,{})]}),f("div",{className:"text",children:[e("div",{className:"title",children:u.title}),e("div",{className:"count",children:Ie(u.count)})]})]},b))})})]}),e("div",{className:"divider"}),f("div",{className:"media-types",children:[e("div",{className:"subtitle",children:t("APPS.PHOTOS.MEDIA_TYPES")}),e("div",{className:"media-types-items",children:M.map((u,b)=>f("div",{className:"item",onClick:()=>{if(s)return h("info","Edit mode is enabled, cannot open media type");_.set({...u,id:null,cover:null,type:u.id})},children:[f("div",{className:"type",children:[u.icon,u.title]}),f("div",{className:"action",children:[e("div",{className:"count",children:u.count}),e(ce,{})]})]},b))})]})]})})}const Ne=()=>{const o=U(_),s=U(w),[n,m]=E.useState([]),[p,T]=E.useState([]),[M,y]=E.useState(!1),[L,B]=E.useState(!1),[P,u]=E.useState(!1),[b,C]=E.useState(0);E.useEffect(()=>{I("Camera",{action:"getImages",filter:{album:o.id,type:o.type}}).then(O=>{if(!O)return h("warning","No data was returned from getImages event");T(O.reverse()),y(O.length===0)})},[]);const R=O=>{if(L||P)return;let c=document.querySelector("#last");if(!c)return;!Z(c)&&(u(!0),I("Camera",{action:"getImages",page:b+1,filter:{album:o.id,type:o.type}}).then(i=>{i&&i.length>0?(T([...i.reverse(),...p]),u(!1),i.length<32&&B(!0)):B(!0)}),C(i=>i+1))};return f(G.div,{initial:{opacity:0,x:35},animate:{opacity:1,x:0},exit:{opacity:0,x:35},transition:{duration:.25,ease:"easeInOut"},children:[f("div",{className:"library-header",children:[f("div",{className:"top",children:[e("div",{className:"info",children:f("div",{className:"back",style:{color:p.length<15?"var(--phone-color-blue)":"#ffffff"},onClick:()=>{s&&w.set(!1),_.set(null)},children:[e(se,{}),t("APPS.PHOTOS.ALBUMS")]})}),f("div",{className:"actions",style:{color:p.length<15?"var(--phone-color-blue)":"var(--phone-text-primary)"},children:[e("div",{className:"button",onClick:()=>w.set(!s),children:s?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.SELECT")}),e("div",{className:"button round",onClick:()=>{let O=o.id!=="recents"&&o.id!=="favourites";H.ContextMenu.set({buttons:[J.value.AllowExternal.Gallery&&o.id!=="favourites"&&{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),cb:()=>{let c="";H.PopUp.set({title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),description:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PLACEHOLDER"),onChange:r=>{c=r}},buttons:[{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.CANCEL")},{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PROCEED"),cb:()=>{if(c.includes("data:image"))return h("warning","Data URL not supported");if(J.value.ExternalBlacklistedDomains.some(r=>c.includes(r))){setTimeout(()=>{H.PopUp.set({title:t("COMPONENTS.GALLERY.EXTERNAL_URL"),description:t("COMPONENTS.GALLERY.EXTERNAL_URL_BLACKLISTED"),buttons:[{title:"OK"}]}),h("warning","External URL is blacklisted")},500);return}ge(c,r=>{r?pe(c,null,"import",!0).then(i=>{if(!i)return h("error","Could not save to gallery, server returned false");let d=q(c);T([{id:i,src:c,timestamp:Date.now(),type:"import",isVideo:d},...p]),I("Camera",{action:"getAlbums"}).then(v=>{if(!v)return h("error","No data received from server");let g=Y.map(N=>{const a=v.mediaTypes.find(l=>l.id===N.id);return a?{...N,count:a.count}:N});S.APPS.CAMERA.albums.set(v.albums),S.APPS.CAMERA.mediaTypes.set(g)}),_.set({...o,photoCount:d?o.photoCount:o.photoCount+1,videoCount:d?o.videoCount+1:o.videoCount})}):h("error","Image does not exist")})}}]})}},O&&{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let c="";H.PopUp.set({title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:r=>{c=r}},buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(c.length<1)return h("warning","Input is empty, cannot rename album");h("info","Renaming album",o.id,c),I("Camera",{action:"renameAlbum",id:o.id,title:c}).then(r=>{if(!r)return h("error","Could not rename album, server returned false");_.set({...o,title:c}),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(i=>i.id===o.id?{...i,title:c}:i))})}}]})}},O&&{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{H.PopUp.set({title:t("APPS.PHOTOS.REMOVE_ALBUM.TITLE").format({name:o.title}),description:t("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION").format({name:o.title}),buttons:[{title:t("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:t("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{I("Camera",{action:"deleteAlbum",id:o.id}).then(c=>{if(!c)return h("error","Could not remove album, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.filter(r=>r.id!==o.id)),_.set(null)})}}]})}}]})},children:e(Ae,{})})]})]}),e("div",{className:"name",style:{color:p.length<15?"var(--phone-text-primary)":"#ffffff"},children:o.title})]}),f("div",{className:"library-content","data-offset":p.length<15,onScroll:R,children:[M&&f("div",{className:"no-photos",children:[e("div",{className:"title",children:t("APPS.PHOTOS.NO_PHOTOS")}),e("div",{className:"description",children:t("APPS.PHOTOS.NO_PHOTOS_INSTRUCTIONS")})]}),!s&&o.photoCount!==void 0&&!M&&e("div",{className:"info",children:t("APPS.PHOTOS.PHOTO_COUNT").format({photos:o.photoCount,videos:o.videoCount})}),e("div",{className:"library-grid",children:p.map((O,c)=>f("div",{id:c===0?"last":"",className:"grid-item",onClick:()=>{if(s){const i=n.find(d=>d.id===O.id);m(i?n.filter(d=>d.id!==O.id):[...n,O])}else V.set({activeImage:O,images:p})},children:[O.isVideo?e(X,{src:O.src,showAdvanced:!s}):e("div",{className:"img",style:{backgroundImage:`url(${O.src})`}}),e("div",{className:"checkbox",children:s&&(n.find(i=>i.id===O.id)?e(K,{checked:!0}):e(K,{checked:!1}))})]},c))})]}),s&&f("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":n.length===0,children:e(te,{})}),e("div",{className:"title",children:n.length===0?t("APPS.PHOTOS.SELECT_ITEMS"):t("APPS.PHOTOS.SELECTED_COUNT").format({count:n.length})}),f("div",{className:"icons","data-disabled":n.length===0,children:[e(ie,{onClick:()=>{if(n.length===0)return;let O=o.id!=="recents"&&o.id!=="favourites";H.ContextMenu.set({title:O&&t("APPS.PHOTOS.DELETE_CONTEXT_TITLE").format({type:n.length>1?t("APPS.PHOTOS.THESE_PHOTOS"):t("APPS.PHOTOS.THIS_PHOTO")}),buttons:[O&&{title:t("APPS.PHOTOS.REMOVE_FROM_ALBUM"),cb:()=>{I("Camera",{action:"removeFromAlbum",album:o.id,ids:n.map(c=>c.id)}).then(c=>{if(!c)return h("error","Could not remove from album, server returned false");let r=o.photoCount-n.filter(d=>!d.isVideo).length,i=o.videoCount-n.filter(d=>d.isVideo).length;S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(d=>{if(d.id===o.id)return{...d,count:d.count-n.length,photoCount:r,videoCount:i}})),_.set({...o,photoCount:r,videoCount:i}),T(p.filter(d=>!n.find(v=>d.id===v.id))),m([]),w.set(!1)})}},{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{I("Camera",{action:"deleteFromGallery",ids:n.map(c=>c.id)}).then(c=>{if(!c)return h("error","Could not delete from gallery, server returned false");let r=0;n.forEach(v=>{r+=v.size}),window.postMessage({action:"phone:updateStorage",add:!1,size:r});let i=o.photoCount-n.filter(v=>!v.isVideo).length,d=o.videoCount-n.filter(v=>v.isVideo).length;I("Camera",{action:"getAlbums"}).then(v=>{if(!v)return h("error","No data received from server");let g=Y.map(N=>{const a=v.mediaTypes.find(l=>l.id===N.id);return a?{...N,count:a.count}:N});S.APPS.CAMERA.albums.set(v.albums),S.APPS.CAMERA.mediaTypes.set(g)}),_.set({...o,photoCount:i,videoCount:d}),T(p.filter(v=>!n.find(g=>v.id===g.id))),m([]),w.set(!1)})}}]})}}),e(re,{onClick:()=>{n.length!==0&&H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{x.set({images:n,onSelect:O=>{I("Camera",{action:"addToAlbum",album:O.id,ids:n.map(c=>c.id)}).then(c=>{if(!c)return h("error","Could not add to album, server returned false");m([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(r=>r.id===O.id?{...r,count:r.count+n.length,photoCount:r.photoCount+n.filter(i=>!i.isVideo).length,videoCount:r.videoCount+n.filter(i=>i.isVideo).length,cover:n[n.length-1].src}:r))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{I("Camera",{action:"toggleFavourites",ids:n.map(O=>O.id),favourite:!0}).then(O=>{if(!O)return h("error","Could not add to favourites, server returned false");m([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(c=>c.id==="favourites"?{...c,count:c.count+n.length,photoCount:c.photoCount+n.filter(r=>!r.isVideo).length,videoCount:c.videoCount+n.filter(r=>r.isVideo).length,cover:n[n.length-1].src}:c))})}}]})}})]})]})]})};t("APPS.PHOTOS.YEARS"),t("APPS.PHOTOS.MONTHS"),t("APPS.PHOTOS.DAYS"),t("APPS.PHOTOS.ALL_PHOTOS");function Le(){const o=U(w),[s,n]=E.useState([]),[m,p]=E.useState([]),[T,M]=E.useState(!1);E.useState("all");const[y,L]=E.useState(null),[B,P]=E.useState(!1),[u,b]=E.useState(!1),[C,R]=E.useState(0),O=()=>{var W,oe;let i=[],d=document.querySelectorAll(".grid-item");if(d.length===0||(d.forEach(F=>{!Z(F)&&i.push(F)}),i.length===0))return L(null);let v=i[0],g=parseInt(v==null?void 0:v.getAttribute("data-id"));if(!g)return;let N=(W=m.find(F=>F.id===g))==null?void 0:W.timestamp,a=i[i.length-1],l=parseInt(a.getAttribute("data-id")),A;if(l&&(A=(oe=m.find(F=>F.id===l))==null?void 0:oe.timestamp),!N)return;let D=c(N),k=c(A);if(D===k||!A)return L(D);L(`${D} - ${k}`)},c=i=>{let d=new Date(i/1e3),v=d.toLocaleString("default",{month:"short"}),g=d.getDate(),N=d.getFullYear();return`${g} ${v} ${N}`};E.useEffect(()=>{I("Camera",{action:"getImages"}).then(i=>{if(!i)return h("warning","No data was returned from getImages event");p(i.reverse()),M(i.length===0)})},[]);const r=i=>{if(O(),B||u)return;let d=document.querySelector("#last");if(!d)return;!Z(d)&&(b(!0),I("Camera",{action:"getImages",page:C+1}).then(g=>{g&&g.length>0?(p([...g.reverse(),...m]),b(!1),g.length<32&&P(!0)):P(!0)}),R(g=>g+1))};return f(j,{children:[e("div",{className:"library-header",children:f("div",{className:"top",children:[e("div",{className:"info",children:e("div",{className:"date",style:{color:m.length<15?"var(--phone-text-primary)":"#ffffff"},children:y&&y})}),e("div",{className:"actions",children:e("div",{className:"button",onClick:()=>w.set(!o),children:o?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.SELECT")})})]})}),e("div",{className:"library-content","data-offset":m.length<15,onScroll:r,children:e("div",{className:"library-grid","data-zoomlevel":Ue[1].toString(),children:m.map((i,d)=>f("div",{id:d===0?"last":"",className:"grid-item","data-id":i.id,onClick:()=>{if(o){const g=s.find(N=>N.id===i.id);n(g?s.filter(N=>N.id!==i.id):[...s,i])}else V.set({activeImage:i,images:m})},children:[i.isVideo?e(X,{src:i.src,showAdvanced:!o}):e("div",{className:"img",style:{backgroundImage:`url(${i.src})`}}),e("div",{className:"checkbox",children:o&&(s.find(g=>g.id===i.id)?e(K,{checked:!0}):e(K,{checked:!1}))})]}))})}),o&&f("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":s.length===0,children:e(te,{})}),e("div",{className:"title",children:s.length===0?t("APPS.PHOTOS.SELECT_ITEMS"):t("APPS.PHOTOS.SELECTED_COUNT").format({count:s.length})}),f("div",{className:"icons","data-disabled":s.length===0,children:[e(ie,{onClick:()=>{s.length!==0&&H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{I("Camera",{action:"deleteFromGallery",ids:s.map(i=>i.id)}).then(()=>{p(m.filter(d=>!s.find(v=>d.src===v.src))),n([]);let i=0;s.forEach(d=>{i+=d.size}),window.postMessage({action:"phone:updateStorage",add:!1,size:i}),I("Camera",{action:"getAlbums"}).then(d=>{if(!d)return h("error","No data received from server");let v=Y.map(g=>{const N=d.mediaTypes.find(a=>a.id===g.id);return N?{...g,count:N.count}:g});S.APPS.CAMERA.albums.set(d.albums),S.APPS.CAMERA.mediaTypes.set(v)})})}}]})}}),e(fe,{onClick:()=>{s.length!==0&&H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{x.set({images:s,onSelect:i=>{I("Camera",{action:"addToAlbum",album:i.id,ids:s.map(d=>d.id)}).then(d=>{if(!d)return h("error","Could not add to album, server returned false");n([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(v=>v.id===i.id?{...v,count:v.count+s.length,photoCount:v.photoCount+s.filter(g=>!g.isVideo).length,videoCount:v.videoCount+s.filter(g=>g.isVideo).length,cover:s[s.length-1].src}:v))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{I("Camera",{action:"toggleFavourites",ids:s.map(i=>i.id),favourite:!0}).then(i=>{if(!i)return h("error","Could not add to favourites, server returned false");n([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(d=>d.id==="favourites"?{...d,count:d.count+s.length,photoCount:d.photoCount+s.filter(v=>!v.isVideo).length,videoCount:d.videoCount+s.filter(v=>v.isVideo).length,cover:s[s.length-1].src}:d))})}}]})}})]})]})]})}function Re(){var m,p,T;const o=U(x),s=U(S.APPS.CAMERA.albums);let n=(m=o==null?void 0:o.images)==null?void 0:m[(o==null?void 0:o.images.length)-1];return f(G.div,{initial:{opacity:0,scale:.9,y:250},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:250},className:"addtoalbum-container",children:[f("div",{className:"addtoalbum-header",children:[e("div",{}),e("div",{className:"title",children:t("APPS.PHOTOS.ADD_TO_ALBUM")}),e("div",{className:"cancel",onClick:()=>x.reset(),children:t("APPS.PHOTOS.CANCEL")})]}),f("div",{className:"addtoalbum-content",children:[f("div",{className:"preview",children:[q(n==null?void 0:n.src)?e(X,{src:n==null?void 0:n.src,showAdvanced:!1}):e("img",{src:n==null?void 0:n.src}),e("div",{className:"title",children:t("APPS.PHOTOS.SELECTED_COUNT").format({count:(p=o==null?void 0:o.images)==null?void 0:p.length})})]}),e("div",{className:"albums",children:(T=s==null?void 0:s.filter(M=>M.id!=="favourites"&&M.id!=="recents"))==null?void 0:T.map((M,y)=>f("div",{className:"album",onClick:()=>{o.onSelect(M),x.reset()},children:[e("div",{className:"cover",children:q(M.cover)?e(X,{src:M.cover,showAdvanced:!1}):e("img",{src:M.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"})}),e("div",{className:"title",children:M.title}),e("div",{className:"count",children:M.count})]},y))})]})]})}function He(){const o=U(ee),[s,n]=E.useState([{icon:e(he,{}),title:t("APPS.PHOTOS.LIBRARY"),value:"library"},{icon:e(Se,{}),title:t("APPS.PHOTOS.ALBUMS"),value:"albums"}]);return e("div",{className:"photos-footer",children:s.map((m,p)=>f("div",{className:"item","data-active":o===m.value,onClick:()=>{ee.set(m.value),m.value==="albums"&&o==="albums"&&(_!=null&&_.value)&&_.reset()},children:[m.icon,m.title]},p))})}const ye=()=>{var v,g,N;const o=U(J),s=U(Te.Settings),[n,m]=E.useState(!0),[p,T]=E.useState(!1),[M,y]=E.useState(0),L=E.useRef(null),B=E.useRef(null),P=U(V),[u,b]=E.useState(new Date(((g=(v=V==null?void 0:V.value)==null?void 0:v.activeImage)==null?void 0:g.timestamp)??0/1e3)),[C,R]=E.useState(((N=P==null?void 0:P.activeImage)==null?void 0:N.favourite)??!1),[O,c]=E.useState([]);let r=(P==null?void 0:P.images)??[];E.useEffect(()=>{if(!(P!=null&&P.activeImage))return h("warning","No active image when changing volume");if(P.activeImage.isVideo){const a=document.getElementById(P.activeImage.id);if(!a)return;a.volume=s.sound.volume}},[s.sound.volume]),E.useEffect(()=>{var l;if(!P)return;let a=r.findIndex(A=>A.id===P.activeImage.id);if(y(a),R(P.activeImage.favourite),P.activeImage.isVideo){const A=document.getElementById(P.activeImage.id);if(!A)return h("warning","Video Element not found (Carousel effect)");A.play(),A.volume=s.sound.volume}if(r.length>0){let A=[];a===0?A=r.slice(0,12):a===r.length-1?A=r.slice(r.length-12,r.length):a<6?A=r.slice(0,12):a>r.length-6?A=r.slice(r.length-12,r.length):A=r.slice(a-6,a+6),b(new Date(((l=r==null?void 0:r[a])==null?void 0:l.timestamp)/1e3)),c(A)}},[P==null?void 0:P.activeImage]);const i={pos:{startLeft:0,startX:0},onMouseDown:a=>{i.pos={startLeft:L.current.scrollLeft,startX:a.clientX},L.current.style.userSelect="none",document.addEventListener("mouseup",i.onMouseUp),document.addEventListener("mousemove",i.onMove),T(!0)},onMove:a=>{if(!L.current)return;const l=(a.clientX-i.pos.startX)/Q();L.current.scrollLeft=i.pos.startLeft-l;const A=L.current.getBoundingClientRect();(A.left*Q()-5>a.clientX||a.clientX>A.right*Q()-5)&&i.onMouseUp()},onMouseUp:()=>{if(!L.current)return;L.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",i.onMouseUp),document.removeEventListener("mousemove",i.onMove);const a=L.current.clientWidth;let l=M;const A=L.current.scrollLeft-i.pos.startLeft;if(A>a/2&&l<r.length?l++:A<-a/2&&l>0&&l--,P.activeImage.id!==r[l].id&&P.activeImage.isVideo){const k=document.getElementById(P.activeImage.id);k&&(k.pause(),k.currentTime=0)}V.set({activeImage:r[l],images:r}),document.getElementById(r[l].id).scrollIntoView({behavior:"smooth",block:"center"}),T(!1)}},d=a=>{P.activeImage.isVideo&&document.getElementById(P.activeImage.id).pause(),V.set({activeImage:a,images:r}),document.getElementById(a.id).scrollIntoView({behavior:"smooth",block:"center"})};return f(G.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},className:"activephoto-container",children:[e(z,{children:n&&f(G.div,{className:"photo-top",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"back",onClick:()=>{H.Share.reset(),V.reset()},children:e(se,{})}),f("div",{className:"date",children:[u.toLocaleString([],{day:"2-digit",month:"long"}),e("span",{children:u.toLocaleTimeString(o.DateLocale,{hour:"numeric",minute:"numeric",hour12:s.time.twelveHourClock})})]}),e("div",{children:e(re,{onClick:()=>{H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{x.set({images:[P.activeImage],onSelect:a=>{I("Camera",{action:"addToAlbum",album:a.id,ids:[P.activeImage.id]}).then(l=>{if(!l)return h("error","Could not add to album, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(A=>A.id===a.id?{...A,count:A.count+1,photoCount:P.activeImage.isVideo?A.photoCount:A.photoCount+1,videoCount:P.activeImage.isVideo?A.videoCount+1:A.videoCount,cover:P.activeImage.src}:A))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{I("Camera",{action:"toggleFavourites",ids:[P.activeImage.id],favourite:!0}).then(a=>{if(!a)return h("error","Could not add to favourites, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(l=>l.id==="favourites"?{...l,count:l.count+1,photoCount:P.activeImage.isVideo?l.photoCount:l.photoCount+1,videoCount:P.activeImage.isVideo?l.videoCount+1:l.videoCount,cover:P.activeImage.src}:l))})}}]})}})})]})}),e("div",{className:"image-overflow",ref:L,onMouseDown:i.onMouseDown,onClick:()=>{p||m(!n)},children:r==null?void 0:r.map((a,l)=>{const A=a.id===P.activeImage.id;return a.isVideo?e("video",{id:a.id,src:a.src,className:A?"active":null,crossOrigin:"anonymous",loop:!0,onLoadedMetadata:D=>{A&&(D.target.scrollIntoView({block:"center"}),D.target.play())}},l):e(Ce,{id:a.id,src:a.src,className:A?"active":null,ignoreStreamerMode:!0,onLoad:D=>{A&&D.target.scrollIntoView({block:"center"})}},l)})}),e(z,{children:n&&f(G.div,{className:"photo-bottom-wrapper",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"photo-carousel",ref:B,children:O.map((a,l)=>a.isVideo?e("video",{src:a.src,"data-carousel":l,controls:!1,muted:!0,onClick:A=>d(a)},l):e("img",{src:a.src,"data-carousel":l,onClick:A=>d(a)},l))}),f("div",{className:"photo-bottom",children:[e(te,{onClick:()=>{H.Share.set({type:"image",data:{src:P.activeImage.src,isVideo:P.activeImage.isVideo}})}}),e("div",{onClick:()=>{I("Camera",{action:"toggleFavourites",ids:[P.activeImage.id],favourite:!C}).then(a=>{if(!a)return h("warning","Failed to toggle favourite, server returned success false");R(!C),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(l=>l.id==="favourites"?{...l,count:C?l.count-1:l.count+1,photoCount:P.activeImage.isVideo?l.photoCount:C?l.photoCount-1:l.photoCount+1,videoCount:P.activeImage.isVideo?C?l.videoCount-1:l.videoCount+1:l.videoCount,cover:P.activeImage.src}:l))})},children:C?e(ne,{}):e(Oe,{})}),e(ie,{onClick:()=>{H.PopUp.set({title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.TITLE"),description:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.DESCRIPTION"),buttons:[{title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.CANCEL")},{title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.PROCEED"),color:"red",cb:()=>{I("Camera",{action:"deleteFromGallery",ids:[P.activeImage.id]}).then(a=>{if(!a)return h("error","Could not delete from gallery, server returned false");V.reset(),I("Camera",{action:"getAlbums"}).then(l=>{if(!l)return h("error","No data received from server");let A=Y.map(D=>{const k=l.mediaTypes.find(W=>W.id===D.id);return k?{...D,count:k.count}:D});S.APPS.CAMERA.albums.set(l.albums),S.APPS.CAMERA.mediaTypes.set(A)})})}}]})}})]})]})})]})};const ee=$("albums"),w=$(!1),V=$(null),x=$(null),_e={library:e(Le,{}),albums:e(Me,{})},Ue=[2,3,4,5];function xe(){const o=U(ee),s=U(V),n=U(w),m=U(x);return f("div",{className:"photos-container",children:[e("div",{className:"photos-content",style:{pointerEvents:s?"none":"all"},children:_e[o]}),!n&&e(He,{}),e(z,{children:s&&e(ye,{})}),e(z,{children:m&&e(Re,{})})]})}export{V as ActiveImage,x as AlbumPickerComponent,w as SelectMode,ee as View,xe as default,Ue as zoomLevels};
